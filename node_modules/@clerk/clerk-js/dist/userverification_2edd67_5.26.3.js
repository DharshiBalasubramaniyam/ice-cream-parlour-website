"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([[671],{72:function(e,t,r){r.d(t,{n:function(){return a}});var i=r(4380),o=r(9333),n=r(338);const a=e=>{const{onBackLinkClick:t}=e;return(0,i.Y)(n.ErrorCard,{cardTitle:(0,o.localizationKeys)("signIn.alternativeMethods.getHelp.title"),cardSubtitle:(0,o.localizationKeys)("signIn.alternativeMethods.getHelp.content"),onBackLinkClick:t})}},6761:function(e,t,r){r.d(t,{Cm:function(){return d},Kw:function(){return f},R5:function(){return u},xf:function(){return c}}),r(1732);var i=r(2201),o=r(7425),n=r(2375);const a=e=>t=>"safeIdentifier"in t&&t.safeIdentifier===e;function l(e){if((0,i.Bz)()){const t=e.find((({strategy:e})=>"passkey"===e));if(t)return t}return null}function c(e,t,r){return e&&0!==e.length?r===o._o.Password?function(e,t){const r=l(e);if(r)return r;const i=e.sort(n.Kn)[0];return"password"===i.strategy?i:e.find(a(t))||i||null}(e,t):function(e,t){const r=l(e);if(r)return r;const i=e.sort(n.Ih),o=i.find(a(t));if(o)return o;const c=i[0];return"email_link"===c.strategy?c:e.find(a(t))||c||null}(e,t):null}const s=["passkey","email_code","password","phone_code","email_link"];function d(e){return!!e&&s.includes(e.strategy)}function u(e){if(!e||0===e.length)return null;const t=e.find((e=>"totp"===e.strategy));if(t)return t;return e.find((e=>"phone_code"===e.strategy))||e[0]}const p=["reset_password_phone_code","reset_password_email_code"],f=e=>!!e&&p.includes(e)},8103:function(e,t,r){r.r(t),r.d(t,{UserVerification:function(){return G},UserVerificationModal:function(){return J}});var i=r(4380),o=r(4041),n=r(844),a=r(9333),l=r(166),c=r(338),s=r(6588),d=r(9513),u=r(6761),p=r(1241),f=r(8313),h=r(9927),_=r(3931),C=r(5909);const m=()=>{const{session:e}=(0,_.wV)(),{level:t}=(0,n.useUserVerification)();return{...(0,C.st)(e?e.__experimental_startVerification:void 0,{level:t||"secondFactor",maxAgeMinutes:10},{throttleTime:300})}};function k(e){const t=t=>{const{isLoading:r,data:o}=m();return r||!o?(0,i.Y)(c.LoadingCard,{}):(0,i.Y)(e,{...t})},r=e.displayName||e.name||"Component";return e.displayName=r,t.displayName=r,t}const y=e=>{const{onBackLinkClick:t}=e;return(0,i.Y)(c.ErrorCard,{cardTitle:(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.getHelp.title"),cardSubtitle:(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.getHelp.content"),onBackLinkClick:t})},v=e=>((e,t)=>{const[r,n]=o.useState(!1),a=o.useCallback((()=>n((e=>!e))),[n]);return r?(0,i.Y)(y,{onBackLinkClick:a}):(0,i.Y)(e,{...t,onHavingTroubleClick:a})})(F,{...e}),F=e=>{const{onBackLinkClick:t,onHavingTroubleClick:r,onFactorSelected:o}=e,n=(0,p.f0)(),{data:l}=m(),{firstPartyFactors:d,hasAnyStrategy:u}=(0,s.y)({filterOutFactor:null==e?void 0:e.currentFactor,supportedFirstFactors:l.supportedFirstFactors});return(0,i.Y)(a.Flow.Part,{part:"alternativeMethods",children:(0,i.FD)(c.Card.Root,{children:[(0,i.FD)(c.Card.Content,{children:[(0,i.FD)(c.Header.Root,{showLogo:!0,children:[(0,i.Y)(c.Header.Title,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.title")}),(0,i.Y)(c.Header.Subtitle,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.subtitle")})]}),(0,i.Y)(c.Card.Alert,{children:n.error}),(0,i.Y)(a.Flex,{direction:"col",elementDescriptor:a.descriptors.main,gap:6,children:(0,i.FD)(a.Col,{gap:4,children:[u&&(0,i.Y)(a.Flex,{elementDescriptor:a.descriptors.alternativeMethods,direction:"col",gap:2,children:d.map(((e,t)=>(0,i.Y)(c.ArrowBlockButton,{leftIcon:g(e),textLocalizationKey:b(e),elementDescriptor:a.descriptors.alternativeMethodsBlockButton,textElementDescriptor:a.descriptors.alternativeMethodsBlockButtonText,arrowElementDescriptor:a.descriptors.alternativeMethodsBlockButtonArrow,textVariant:"buttonLarge",isDisabled:n.isLoading,onClick:()=>{n.setError(void 0),o(e)}},t)))}),t&&(0,i.Y)(c.BackLink,{boxElementDescriptor:a.descriptors.backRow,linkElementDescriptor:a.descriptors.backLink,onClick:t})]})})]}),(0,i.Y)(c.Card.Footer,{children:(0,i.FD)(c.Card.Action,{elementId:"havingTrouble",children:[(0,i.Y)(c.Card.ActionText,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.actionText")}),(0,i.Y)(c.Card.ActionLink,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.actionLink"),onClick:r})]})})]})})};function b(e){switch(e.strategy){case"email_code":return(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__emailCode",{identifier:(0,h.uu)(e.safeIdentifier)||""});case"phone_code":return(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__phoneCode",{identifier:(0,h.uu)(e.safeIdentifier)||""});case"password":return(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__password");default:throw`Invalid sign in strategy: "${e.strategy}"`}}function g(e){return{email_code:f.Ps,phone_code:f.bK,password:f.JD}[e.strategy]}var w=r(72),Y=r(5882),V=r(1101);const x=()=>{const{afterVerification:e,routing:t}=(0,n.useUserVerification)(),r=(0,V.p)(),{setActive:i}=(0,_.ho)(),{setCache:a}=m(),{navigate:c}=(0,l.useRouter)(),s=(0,o.useCallback)((async()=>{if("virtual"!==t)throw"afterVerification is only triggered in modals";setTimeout((()=>{null==e||e()}),0)}),[e,t]);return{handleVerificationResponse:(0,o.useCallback)((async e=>{switch(a({data:e,isLoading:!1,isValidating:!1,error:null,cachedAt:Date.now()}),e.status){case"complete":return i({session:e.session.id,beforeEmit:s});case"needs_second_factor":return c("./factor-two");default:return console.error((0,Y.wv)(e.status,r))}}),[s,c,i,r])}};function S(e){const{onShowAlternativeMethodsClick:t}=e,{session:r}=(0,_.wV)(),{handleVerificationResponse:n}=x(),l=(0,c.useCardState)(),[s,d]=o.useState(!1),u=o.useCallback((()=>d((e=>!e))),[d]),p=(0,h.tJ)("password","",{type:"password",label:(0,a.localizationKeys)("formFieldLabel__password"),placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__password")});return s?(0,i.Y)(w.n,{onBackLinkClick:u}):(0,i.Y)(a.Flow.Part,{part:"password",children:(0,i.FD)(c.Card.Root,{children:[(0,i.FD)(c.Card.Content,{children:[(0,i.FD)(c.Header.Root,{showLogo:!0,children:[(0,i.Y)(c.Header.Title,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.password.title")}),(0,i.Y)(c.Header.Subtitle,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.password.subtitle")})]}),(0,i.Y)(c.Card.Alert,{children:l.error}),(0,i.FD)(a.Col,{elementDescriptor:a.descriptors.main,gap:4,children:[(0,i.FD)(c.Form.Root,{onSubmit:async e=>(e.preventDefault(),null==r?void 0:r.__experimental_attemptFirstFactorVerification({strategy:"password",password:p.value}).then(n).catch((e=>(0,h.H4)(e,[p],l.setError)))),gap:8,children:[(0,i.Y)(c.Form.ControlRow,{elementId:p.id,children:(0,i.Y)(c.Form.PasswordInput,{...p.props,autoFocus:!0})}),(0,i.Y)(c.Form.SubmitButton,{hasArrow:!0})]}),(0,i.Y)(c.Card.Action,{elementId:t?"alternativeMethods":"havingTrouble",children:(0,i.Y)(c.Card.ActionLink,{localizationKey:(0,a.localizationKeys)(t?"__experimental_userVerification.password.actionLink":"__experimental_userVerification.alternativeMethods.actionLink"),onClick:t||u})})]})]}),(0,i.Y)(c.Card.Footer,{})]})})}const K=e=>{var t;const{session:r}=(0,_.wV)(),n=(0,c.useCardState)(),{handleVerificationResponse:a}=x();o.useEffect((()=>{e.factorAlreadyPrepared||l()}),[]);const l=()=>{r.__experimental_prepareFirstFactorVerification(e.factor).then((()=>e.onFactorPrepare())).catch((e=>(0,h.H4)(e,[],n.setError)))};return(0,i.Y)(c.VerificationCodeCard,{cardTitle:e.cardTitle,cardSubtitle:e.cardSubtitle,inputLabel:e.inputLabel,resendButton:e.resendButton,onCodeEntryFinishedAction:(t,i,o)=>{r.__experimental_attemptFirstFactorVerification({strategy:e.factor.strategy,code:t}).then((async e=>(await i(),a(e)))).catch(o)},onResendCodeClicked:l,safeIdentifier:e.factor.safeIdentifier,profileImageUrl:null===(t=null==r?void 0:r.user)||void 0===t?void 0:t.imageUrl,onShowAlternativeMethodsClicked:e.onShowAlternativeMethodsClicked,showAlternativeMethods:e.showAlternativeMethods,onBackLinkClicked:e.onBackLinkClicked})},z=e=>(0,i.Y)(a.Flow.Part,{part:"emailCode",children:(0,i.Y)(K,{...e,cardTitle:(0,a.localizationKeys)("__experimental_userVerification.emailCode.title"),cardSubtitle:(0,a.localizationKeys)("__experimental_userVerification.emailCode.subtitle"),inputLabel:(0,a.localizationKeys)("__experimental_userVerification.emailCode.formTitle"),resendButton:(0,a.localizationKeys)("__experimental_userVerification.emailCode.resendButton")})}),M=e=>(0,i.Y)(a.Flow.Part,{part:"phoneCode",children:(0,i.Y)(K,{...e,cardTitle:(0,a.localizationKeys)("__experimental_userVerification.phoneCode.title"),cardSubtitle:(0,a.localizationKeys)("__experimental_userVerification.phoneCode.subtitle"),inputLabel:(0,a.localizationKeys)("__experimental_userVerification.phoneCode.formTitle"),resendButton:(0,a.localizationKeys)("__experimental_userVerification.phoneCode.resendButton")})}),A=e=>{if(!e)return"";let t=e.strategy;return"emailAddressId"in e&&(t+=e.emailAddressId),"phoneNumberId"in e&&(t+=e.phoneNumberId),t},B=k((0,c.withCardStateProvider)((function(){const{data:e}=m(),t=(0,c.useCardState)(),{navigate:r}=(0,l.useRouter)(),a=o.useRef(""),p=e,f=p.supportedFirstFactors,{preferredSignInStrategy:h}=(0,n.useEnvironment)().displayConfig,[{currentFactor:_},C]=o.useState((()=>({currentFactor:(0,u.xf)(f,null,h),prevCurrentFactor:void 0}))),{hasAnyStrategy:k}=(0,s.y)({filterOutFactor:_,supportedFirstFactors:f}),[y,F]=o.useState((()=>!_||!(0,u.Cm)(_))),b=k?()=>F((e=>!e)):void 0,g=()=>{a.current=A(_)};if((0,o.useEffect)((()=>{"needs_second_factor"===p.status&&r("factor-two")}),[]),!_)return(0,i.Y)(c.ErrorCard,{cardTitle:(0,d.GQ)("__experimental_userVerification.noAvailableMethods.title"),cardSubtitle:(0,d.GQ)("__experimental_userVerification.noAvailableMethods.subtitle"),message:(0,d.GQ)("__experimental_userVerification.noAvailableMethods.message"),shouldNavigateBack:!1});if(y){const e=(0,u.Cm)(_),r=b,o=()=>{t.setError(void 0),null==r||r()};return(0,i.Y)(v,{onBackLinkClick:e?o:void 0,onFactorSelected:e=>{var t;t=e,C((e=>({currentFactor:t,prevCurrentFactor:e.currentFactor}))),null==r||r()},currentFactor:_})}switch(null==_?void 0:_.strategy){case"password":return(0,i.Y)(S,{onShowAlternativeMethodsClick:b});case"email_code":return(0,i.Y)(z,{factorAlreadyPrepared:a.current===A(_),onFactorPrepare:g,onShowAlternativeMethodsClicked:b,factor:_});case"phone_code":return(0,i.Y)(M,{factorAlreadyPrepared:a.current===A(_),onFactorPrepare:g,onShowAlternativeMethodsClicked:b,factor:_});default:return(0,i.Y)(c.LoadingCard,{})}}))),L=e=>{var t;const r=(0,c.useCardState)(),{session:n}=(0,_.wV)(),{handleVerificationResponse:a}=x();o.useEffect((()=>{e.factorAlreadyPrepared||null==l||l()}),[]);const l=e.prepare?()=>{var t;return null===(t=e.prepare)||void 0===t?void 0:t.call(e).then((()=>e.onFactorPrepare())).catch((e=>(0,h.H4)(e,[],r.setError)))}:void 0;return(0,i.Y)(c.VerificationCodeCard,{cardTitle:e.cardTitle,cardSubtitle:e.cardSubtitle,resendButton:e.resendButton,inputLabel:e.inputLabel,onCodeEntryFinishedAction:(t,r,i)=>{n.__experimental_attemptSecondFactorVerification({strategy:e.factor.strategy,code:t}).then((async e=>(await r(),a(e)))).catch(i)},onResendCodeClicked:l,safeIdentifier:"safeIdentifier"in e.factor?e.factor.safeIdentifier:void 0,profileImageUrl:null===(t=null==n?void 0:n.user)||void 0===t?void 0:t.imageUrl,onShowAlternativeMethodsClicked:e.onShowAlternativeMethodsClicked})};function D(e){return(0,i.Y)(a.Flow.Part,{part:"totp2Fa",children:(0,i.Y)(L,{...e,cardTitle:(0,a.localizationKeys)("__experimental_userVerification.totpMfa.title"),cardSubtitle:(0,a.localizationKeys)("__experimental_userVerification.totpMfa.subtitle"),inputLabel:(0,a.localizationKeys)("__experimental_userVerification.totpMfa.formTitle")})})}const I=e=>{const[t,r]=o.useState(!1),n=o.useCallback((()=>r((e=>!e))),[r]);return t?(0,i.Y)(y,{onBackLinkClick:n}):(0,i.Y)(T,{supportedSecondFactors:e.supportedSecondFactors,onBackLinkClick:e.onBackLinkClick,onFactorSelected:e.onFactorSelected,onHavingTroubleClick:n})},T=e=>{const{supportedSecondFactors:t,onHavingTroubleClick:r,onFactorSelected:o,onBackLinkClick:n}=e,l=(0,p.f0)();return(0,i.Y)(a.Flow.Part,{part:"alternativeMethods",children:(0,i.FD)(c.Card.Root,{children:[(0,i.FD)(c.Card.Content,{children:[(0,i.FD)(c.Header.Root,{showLogo:!0,children:[(0,i.Y)(c.Header.Title,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.title")}),(0,i.Y)(c.Header.Subtitle,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.subtitle")})]}),(0,i.Y)(c.Card.Alert,{children:l.error}),(0,i.FD)(a.Col,{elementDescriptor:a.descriptors.main,gap:3,children:[(0,i.Y)(a.Col,{gap:2,children:null==t?void 0:t.sort(h.Wy).map(((e,t)=>(0,i.Y)(c.ArrowBlockButton,{textLocalizationKey:R(e),elementDescriptor:a.descriptors.alternativeMethodsBlockButton,textElementDescriptor:a.descriptors.alternativeMethodsBlockButtonText,arrowElementDescriptor:a.descriptors.alternativeMethodsBlockButtonArrow,isDisabled:l.isLoading,onClick:()=>o(e)},t)))}),(0,i.Y)(c.Card.Action,{elementId:"alternativeMethods",children:n&&(0,i.Y)(c.Card.ActionLink,{localizationKey:(0,a.localizationKeys)("backButton"),onClick:e.onBackLinkClick})})]})]}),(0,i.Y)(c.Card.Footer,{children:(0,i.FD)(c.Card.Action,{elementId:"havingTrouble",children:[(0,i.Y)(c.Card.ActionText,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.actionText")}),(0,i.Y)(c.Card.ActionLink,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.actionLink"),onClick:r})]})})]})})};function R(e){switch(e.strategy){case"phone_code":return(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__phoneCode",{identifier:(0,h.uu)(e.safeIdentifier)||""});case"totp":return(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__totp");case"backup_code":return(0,a.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__backupCode");default:throw`Invalid verification strategy: "${e.strategy}"`}}const P=e=>{const{onShowAlternativeMethodsClicked:t}=e,{session:r}=(0,_.wV)(),{handleVerificationResponse:o}=x(),n=(0,c.useCardState)(),l=(0,h.tJ)("code","",{type:"text",label:(0,a.localizationKeys)("formFieldLabel__backupCode"),isRequired:!0});return(0,i.FD)(c.Card.Root,{children:[(0,i.FD)(c.Card.Content,{children:[(0,i.FD)(c.Header.Root,{showLogo:!0,children:[(0,i.Y)(c.Header.Title,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.backupCodeMfa.title")}),(0,i.Y)(c.Header.Subtitle,{localizationKey:(0,a.localizationKeys)("__experimental_userVerification.backupCodeMfa.subtitle")})]}),(0,i.Y)(c.Card.Alert,{children:n.error}),(0,i.Y)(a.Col,{elementDescriptor:a.descriptors.main,gap:8,children:(0,i.FD)(c.Form.Root,{onSubmit:e=>(e.preventDefault(),r.__experimental_attemptSecondFactorVerification({strategy:"backup_code",code:l.value}).then(o).catch((e=>(0,h.H4)(e,[l],n.setError)))),children:[(0,i.Y)(c.Form.ControlRow,{elementId:l.id,children:(0,i.Y)(c.Form.PlainInput,{...l.props,autoFocus:!0,onActionClicked:t})}),(0,i.FD)(a.Col,{gap:3,children:[(0,i.Y)(c.Form.SubmitButton,{hasArrow:!0}),(0,i.Y)(c.Card.Action,{elementId:"alternativeMethods",children:t&&(0,i.Y)(c.Card.ActionLink,{localizationKey:(0,a.localizationKeys)("footerActionLink__useAnotherMethod"),onClick:t})})]})]})})]}),(0,i.Y)(c.Card.Footer,{})]})},H=e=>{const{session:t}=(0,_.wV)();return(0,i.Y)(a.Flow.Part,{part:"phoneCode2Fa",children:(0,i.Y)(L,{...e,cardTitle:(0,a.localizationKeys)("__experimental_userVerification.phoneCodeMfa.title"),cardSubtitle:(0,a.localizationKeys)("__experimental_userVerification.phoneCodeMfa.subtitle"),inputLabel:(0,a.localizationKeys)("__experimental_userVerification.phoneCodeMfa.formTitle"),resendButton:(0,a.localizationKeys)("__experimental_userVerification.phoneCodeMfa.resendButton"),prepare:()=>{const{phoneNumberId:r,strategy:i}=e.factor;return t.__experimental_prepareSecondFactorVerification({phoneNumberId:r,strategy:i})}})})},E=e=>{if(!e)return"";let t=e.strategy;return"phoneNumberId"in e&&(t+=e.phoneNumberId),t},N=k((0,c.withCardStateProvider)((function(){const{navigate:e}=(0,l.useRouter)(),{data:t}=m(),r=t,n=r.supportedSecondFactors,a=o.useRef(""),[s,d]=o.useState((()=>(0,u.R5)(n))),[p,f]=o.useState(!s),h=()=>f((e=>!e)),_=()=>{a.current=E(s)};if((0,o.useEffect)((()=>{"needs_first_factor"===r.status&&e("../")}),[]),!s)return(0,i.Y)(c.LoadingCard,{});if(p)return(0,i.Y)(I,{supportedSecondFactors:r.supportedSecondFactors,onBackLinkClick:h,onFactorSelected:e=>{d(e),h()}});switch(null==s?void 0:s.strategy){case"phone_code":return(0,i.Y)(H,{factorAlreadyPrepared:a.current===E(s),onFactorPrepare:_,factor:s,onShowAlternativeMethodsClicked:h});case"totp":return(0,i.Y)(D,{factorAlreadyPrepared:a.current===E(s),onFactorPrepare:_,factor:s,onShowAlternativeMethodsClicked:h});case"backup_code":return(0,i.Y)(P,{onShowAlternativeMethodsClicked:h});default:return(0,i.Y)(c.LoadingCard,{})}})));function U(){return(0,i.Y)(a.Flow.Root,{flow:"userVerification",children:(0,i.FD)(l.Switch,{children:[(0,i.Y)(l.Route,{path:"factor-two",children:(0,i.Y)(N,{})}),(0,i.Y)(l.Route,{index:!0,children:(0,i.Y)(B,{})})]})})}U.displayName="UserVerification";const G=(0,n.withCoreSessionSwitchGuard)(U),J=e=>(0,i.Y)(l.Route,{path:"user-verification",children:(0,i.Y)(n.ComponentContext.Provider,{value:{componentName:"UserVerification",...e,routing:"virtual"},children:(0,i.Y)("div",{children:(0,i.Y)(G,{...e,routing:"virtual"})})})})}}]);