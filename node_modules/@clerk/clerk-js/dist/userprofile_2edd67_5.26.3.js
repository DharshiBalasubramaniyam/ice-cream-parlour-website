"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([[45],{4994:function(e,o,r){r.r(o),r.d(o,{UserProfile:function(){return co},UserProfileModal:function(){return uo}});var t=r(4380),i=r(4041),n=r(844),s=r(9333),l=r(338),a=r(166),c=r(9513);const d=e=>{const{pages:o}=(0,n.useUserProfileContext)();return(0,t.FD)(l.NavbarContextProvider,{children:[(0,t.Y)(l.NavBar,{title:(0,c.GQ)("userProfile.navbar.title"),description:(0,c.GQ)("userProfile.navbar.description"),routes:o.routes,contentRef:e.contentRef}),e.children]})};var u=r(9834),m=r(2237),h=r(3931),f=r(4870),p=r(7362),v=r(3090),P=r(2572),g=r(5909),y=r(4859),Y=r(9927);const b=()=>{const e=(0,l.useCardState)(),{user:o}=(0,h.Jd)(),{navigate:r}=(0,a.useRouter)(),{strategies:i,strategyToDisplayData:c}=(0,g.kF)(),{additionalOAuthScopes:d,componentName:u,mode:m}=(0,n.useUserProfileContext)(),{handleAssurance:v}=(0,y.r)(),P="modal"===m,b=i.filter((e=>e.startsWith("oauth"))),S=null==o?void 0:o.verifiedExternalAccounts.map((e=>`oauth_${e.provider}`)),C=b.filter((e=>!S.includes(e)));return 0===C.length?null:(0,t.Y)(l.ProfileSection.ActionMenu,{triggerLocalizationKey:(0,s.localizationKeys)("userProfile.start.connectedAccountsSection.primaryButton"),id:"connectedAccounts",children:C.map((i=>{const n=c[i].iconUrl?(0,t.Y)(s.Image,{isLoading:e.loadingMetadata===i,isDisabled:e.isLoading,elementDescriptor:s.descriptors.providerIcon,elementId:s.descriptors.providerIcon.setId(c[i].id),src:c[i].iconUrl,alt:`Connect ${c[i].name} account`,sx:e=>({width:e.sizes.$4})}):(0,t.Y)(p.Tr,{id:c[i].id,value:c[i].name,isLoading:e.loadingMetadata===i,isDisabled:e.isLoading});return(0,t.Y)(l.ProfileSection.ActionMenuItem,{id:c[i].id,onClick:()=>(t=>{if(!o)return;const i=t.replace("oauth_",""),n=P?(0,f.jk)({url:window.location.href,componentName:u,socialProvider:i}):window.location.href,s=d?d[i]:[];return e.setLoading(t),v((()=>o.createExternalAccount({strategy:t,redirectUrl:n,additionalScopes:s}))).then((o=>{var i;(null===(i=o.verification)||void 0===i?void 0:i.externalVerificationRedirectURL)&&((0,Y.yy)(2e3).then((()=>e.setIdle(t))),r(o.verification.externalVerificationRedirectURL.href))})).catch((o=>{(0,Y.H4)(o,[],e.setError),e.setIdle(t)}))})(i),isDisabled:e.isLoading,variant:"ghost",isLoading:e.loadingMetadata===i,focusRing:!1,closeAfterClick:!1,localizationKey:(0,s.localizationKeys)("userProfile.connectedAccountPage.socialButtonsBlockButton",{provider:c[i].name}),sx:e=>({justifyContent:"start",gap:e.space.$2}),leftIcon:n},i)}))})},S=e=>{var o;const{onSuccess:r,onReset:n}=e,{user:l}=(0,h.Jd)(),{emailId:a}=e,c=null==l?void 0:l.emailAddresses.find((e=>e.id===a)),d=i.useRef(null==c?void 0:c.emailAddress),u="verified"===(null===(o=null==c?void 0:c.verification)||void 0===o?void 0:o.status)?(0,s.localizationKeys)("userProfile.emailAddressPage.removeResource.messageLine2"):void 0;return d.current?(0,t.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.emailAddressPage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.emailAddressPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,s.localizationKeys)("userProfile.emailAddressPage.removeResource.successMessage",{emailAddress:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:r,onReset:n}):null},C=e=>{var o;const{phoneId:r,onSuccess:n,onReset:l}=e,{user:a}=(0,h.Jd)(),c=null==a?void 0:a.phoneNumbers.find((e=>e.id===r)),d=i.useRef(null==c?void 0:c.phoneNumber),u="verified"===(null===(o=null==c?void 0:c.verification)||void 0===o?void 0:o.status)?(0,s.localizationKeys)("userProfile.phoneNumberPage.removeResource.messageLine2"):void 0;return d.current?(0,t.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.phoneNumberPage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.phoneNumberPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,s.localizationKeys)("userProfile.phoneNumberPage.removeResource.successMessage",{phoneNumber:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:n,onReset:l}):null},z=e=>{var o,r;const{accountId:n,onSuccess:l,onReset:a}=e,{user:c}=(0,h.Jd)(),d=null==c?void 0:c.externalAccounts.find((e=>e.id===n)),u=i.useRef(null==d?void 0:d.provider),{providerToDisplayData:m}=(0,g.kF)();return u.current?(0,t.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.connectedAccountPage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.connectedAccountPage.removeResource.messageLine1",{identifier:null===(o=m[u.current])||void 0===o?void 0:o.name}),messageLine2:(0,s.localizationKeys)("userProfile.connectedAccountPage.removeResource.messageLine2"),successMessage:(0,s.localizationKeys)("userProfile.connectedAccountPage.removeResource.successMessage",{connectedAccount:null===(r=m[u.current])||void 0===r?void 0:r.name}),deleteResource:()=>Promise.resolve(null==d?void 0:d.destroy()),onSuccess:l,onReset:a}):null},F=e=>{var o;const{user:r}=(0,h.Jd)(),{walletId:n,onSuccess:l,onReset:a}=e,c=null==r?void 0:r.web3Wallets.find((e=>e.id===n)),d=i.useRef(null==c?void 0:c.web3Wallet),u="verified"===(null===(o=null==c?void 0:c.verification)||void 0===o?void 0:o.status)?(0,s.localizationKeys)("userProfile.web3WalletPage.removeResource.messageLine2"):void 0;return d.current?(0,t.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.web3WalletPage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.web3WalletPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,s.localizationKeys)("userProfile.web3WalletPage.removeResource.successMessage",{web3Wallet:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:l,onReset:a}):null},K=e=>{const{user:o}=(0,h.Jd)(),{phoneId:r,onSuccess:n,onReset:l}=e,a=null==o?void 0:o.phoneNumbers.find((e=>e.id===r)),c=i.useRef(null==a?void 0:a.phoneNumber);return c.current?(0,t.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.messageLine1",{identifier:c.current}),messageLine2:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.messageLine2"),successMessage:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.successMessage",{mfaPhoneCode:c.current}),deleteResource:()=>Promise.resolve(null==a?void 0:a.setReservedForSecondFactor({reserved:!1})),onSuccess:n,onReset:l}):null},R=e=>{const{onSuccess:o,onReset:r}=e,{user:i}=(0,h.Jd)();return i?(0,t.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.mfaTOTPPage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.mfaTOTPPage.removeResource.messageLine1"),messageLine2:(0,s.localizationKeys)("userProfile.mfaTOTPPage.removeResource.messageLine2"),successMessage:(0,s.localizationKeys)("userProfile.mfaTOTPPage.removeResource.successMessage"),deleteResource:i.disableTOTP,onSuccess:o,onReset:r}):null},D=e=>{const{onSuccess:o,onReset:r,passkey:i}=e;return(0,t.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.passkeyScreen.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.passkeyScreen.removeResource.messageLine1",{name:i.name}),deleteResource:i.delete,onSuccess:o,onReset:r})},x=e=>{const{close:o}=(0,P.D5)();return(0,t.Y)(z,{onSuccess:o,onReset:o,...e})},_=["external_account_missing_refresh_token","oauth_fetch_user_error","oauth_token_exchange_error","external_account_email_address_verification_required"],w=(0,l.withCardStateProvider)((({shouldAllowCreation:e=!0})=>{var o;const{user:r}=(0,h.Jd)(),i=(0,l.useCardState)(),n=Boolean(null===(o=null==r?void 0:r.externalAccounts)||void 0===o?void 0:o.length);if(!r||!e&&!n)return null;const a=[...r.verifiedExternalAccounts,...r.unverifiedExternalAccounts.filter((e=>{var o;return null===(o=e.verification)||void 0===o?void 0:o.error}))];return(0,t.FD)(l.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.connectedAccountsSection.title"),centered:!1,id:"connectedAccounts",children:[(0,t.Y)(l.Card.Alert,{children:i.error}),(0,t.FD)(v.r.Root,{children:[(0,t.Y)(l.ProfileSection.ItemList,{id:"connectedAccounts",children:a.map((e=>(0,t.Y)(T,{account:e},e.id)))}),e&&(0,t.Y)(b,{})]})]})})),T=({account:e})=>{var o,r,i,c,d,u;const{additionalOAuthScopes:m,componentName:P,mode:b}=(0,n.useUserProfileContext)(),{navigate:S}=(0,a.useRouter)(),{user:C}=(0,h.Jd)(),z=(0,l.useCardState)(),{handleAssurance:F}=(0,y.r)();if(!C)return null;const K="modal"===b,{providerToDisplayData:R}=(0,g.kF)(),D=e.username||e.emailAddress,w=null===(r=null===(o=e.verification)||void 0===o?void 0:o.error)||void 0===r?void 0:r.longMessage,T=function(e,o){if(!o)return[];const r=o[e.provider]||[],t=e.approvedScopes.split(" ");return 0===r.filter((e=>!t.includes(e))).length?[]:r}(e,m),k=T.length>0&&""!=e.approvedScopes,I=_.includes((null===(c=null===(i=e.verification)||void 0===i?void 0:i.error)||void 0===c?void 0:c.code)||"")||k,B=I?(0,s.localizationKeys)("userProfile.start.connectedAccountsSection.subtitle__disconnected"):w;return(0,t.FD)(v.r.Root,{children:[(0,t.FD)(l.ProfileSection.Item,{id:"connectedAccounts",children:[(0,t.FD)(s.Flex,{sx:e=>({overflow:"hidden",gap:e.space.$2}),children:[(0,t.Y)((()=>R[e.provider].iconUrl?(0,t.Y)(s.Image,{elementDescriptor:[s.descriptors.providerIcon],elementId:s.descriptors.socialButtonsProviderIcon.setId(e.provider),alt:R[e.provider].name,src:R[e.provider].iconUrl,sx:e=>({width:e.sizes.$4,flexShrink:0})}):(0,t.Y)(p.Tr,{id:e.provider,value:R[e.provider].name})),{}),(0,t.Y)(s.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,t.FD)(s.Flex,{gap:2,center:!0,children:[(0,t.Y)(s.Text,{sx:e=>({color:e.colors.$colorText}),children:`${R[e.provider].name}`}),(0,t.Y)(s.Text,{truncate:!0,as:"span",colorScheme:"secondary",children:D?`• ${D}`:""})]})})]}),(0,t.Y)(A,{})]}),I&&(0,t.FD)(s.Box,{sx:e=>({padding:`${e.sizes.$none} ${e.sizes.$none} ${e.sizes.$1x5} ${e.sizes.$8x5}`}),children:[(0,t.Y)(s.Text,{colorScheme:"secondary",sx:e=>({paddingRight:e.sizes.$1x5,display:"inline-block"}),localizationKey:B}),(0,t.Y)(s.Button,{sx:{display:"inline-block"},onClick:async()=>{var o;const r=K?(0,f.jk)({url:window.location.href,componentName:P}):window.location.href;try{let t;t=k?await e.reauthorize({additionalScopes:T,redirectUrl:r}):await F((()=>C.createExternalAccount({strategy:e.verification.strategy,redirectUrl:r,additionalScopes:T}))),await S((null===(o=t.verification.externalVerificationRedirectURL)||void 0===o?void 0:o.href)||"")}catch(t){(0,Y.H4)(t,[],z.setError)}},variant:"link",localizationKey:(0,s.localizationKeys)("userProfile.start.connectedAccountsSection.actionLabel__connectionFailed")})]}),(null===(u=null===(d=e.verification)||void 0===d?void 0:d.error)||void 0===u?void 0:u.code)&&!I&&(0,t.Y)(s.Text,{colorScheme:"danger",sx:e=>({padding:`${e.sizes.$none} ${e.sizes.$1x5} ${e.sizes.$1x5} ${e.sizes.$8x5}`}),children:w}),(0,t.Y)(v.r.Open,{value:"remove",children:(0,t.Y)(v.r.Card,{variant:"destructive",children:(0,t.Y)(x,{accountId:e.id})})})]},e.id)},A=()=>{const{open:e}=(0,P.D5)(),o=[{label:(0,s.localizationKeys)("userProfile.start.connectedAccountsSection.destructiveActionTitle"),isDestructive:!0,onClick:()=>e("remove")}].filter((e=>null!==e));return(0,t.Y)(l.ThreeDotsMenu,{actions:o})},k=e=>e.defaultSecondFactor?-1:1;function I(e){const o=[];return Object.entries(e).forEach((([,e])=>{e.used_for_second_factor&&o.push(...e.second_factors)})),o}function B(e,o){let r=I(e);return o.totpEnabled&&(r=r.filter((e=>"totp"!==e))),!o.backupCodeEnabled&&o.twoFactorEnabled||(r=r.filter((e=>"backup_code"!==e))),r}function L(e,o){if(!e)return[];const r=e.filter((e=>e.id===o)),t=e.filter((e=>e.id!==o)),i=t.filter((e=>{var o;return"verified"===(null===(o=e.verification)||void 0===o?void 0:o.status)})),n=t.filter((e=>{var o,r;return!!(null===(o=e.verification)||void 0===o?void 0:o.status)&&"verified"!==(null===(r=e.verification)||void 0===r?void 0:r.status)})),s=t.filter((e=>!e.verification.status));return i.sort(((e,o)=>e.id.localeCompare(o.id))),n.sort(((e,o)=>{var r,t;return(null===(r=e.verification)||void 0===r?void 0:r.expireAt)&&(null===(t=o.verification)||void 0===t?void 0:t.expireAt)?e.verification.expireAt.getTime()-o.verification.expireAt.getTime():0})),[...r,...i,...n,...s]}const $=e=>{const o=(0,l.useCardState)(),{nextStep:r,identification:n,identifier:a,onReset:c,prepareVerification:d}=e,u=()=>{var e;return null===(e=null==d?void 0:d())||void 0===e?void 0:e.catch((e=>(0,Y.H4)(e,[],o.setError)))},m=(0,l.useFieldOTP)({onCodeEntryFinished:(e,o,r)=>{null==n||n.attemptVerification({code:e}).then((()=>o())).catch(r)},onResendCodeClicked:u,onResolve:r});return i.useEffect((()=>{u()}),[]),(0,t.FD)(t.FK,{children:[(0,t.Y)(l.Form.OTPInput,{...m,label:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:a}),resendButton:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,t.FD)(l.FormButtonContainer,{children:[(0,t.Y)(s.Button,{isLoading:m.isLoading,localizationKey:(0,s.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:s.descriptors.formButtonPrimary,onClick:m.onFakeContinue}),(0,t.Y)(s.Button,{variant:"ghost",isDisabled:m.isLoading,localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset,onClick:c})]})]})};var N=r(7453);const E=e=>{const{email:o,nextStep:r,onReset:a}=e,c=(0,l.useCardState)(),d=(0,n.useUserProfileContext)(),{startEmailLinkFlow:u}=(0,g.ui)(o),{displayConfig:m}=(0,n.useEnvironment)();function h(){const{routing:e}=d,o="virtual"===e?m.userProfileUrl:"",t=(0,N.W)(d,o);u({redirectUrl:t}).then((()=>r())).catch((e=>(0,Y.H4)(e,[],c.setError)))}return i.useEffect((()=>{h()}),[]),(0,t.FD)(t.FK,{children:[(0,t.Y)(l.VerificationLink,{resendButton:(0,s.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:h}),(0,t.Y)(l.FormButtonContainer,{children:(0,t.Y)(s.Button,{variant:"ghost",localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset,onClick:a})})]})},O=()=>(0,t.Y)(p.$W,{title:(0,s.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,s.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"}),M=(0,l.withCardStateProvider)((e=>{var o,r,a;const{emailId:c,onSuccess:d,onReset:u}=e,m=(0,l.useCardState)(),{user:f}=(0,h.Jd)(),{handleAssurance:v}=(0,y.r)(),P=function(e){const{userSettings:o}=e,{email_address:r}=o.attributes;return r.enabled&&r.verifications.includes("email_link")}((0,n.useEnvironment)()),g=i.useRef(null==f?void 0:f.emailAddresses.find((e=>e.id===c))),b=(0,p.Xi)({defaultStep:g.current?1:0,onNextStep:()=>m.setError(void 0)}),S=(0,Y.tJ)("emailAddress","",{type:"email",label:(0,s.localizationKeys)("formFieldLabel__emailAddress"),placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),C=S.value.length>1&&(null==f?void 0:f.username)!==S.value;return(0,t.FD)(p.sQ,{...b.props,children:[(0,t.Y)(l.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.emailAddressPage.title"),headerSubtitle:P?(0,s.localizationKeys)("userProfile.emailAddressPage.emailLink.formHint"):(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formHint"),children:(0,t.FD)(l.Form.Root,{onSubmit:async e=>{if(e.preventDefault(),f)return v((()=>f.createEmailAddress({email:S.value}))).then((e=>{g.current=e,b.nextStep()})).catch((e=>(0,Y.H4)(e,[S],m.setError)))},children:[(0,t.Y)(l.Form.ControlRow,{elementId:S.id,children:(0,t.Y)(l.Form.PlainInput,{...S.props,autoFocus:!0})}),(0,t.Y)(l.FormButtons,{submitLabel:(0,s.localizationKeys)("userProfile.formButtonPrimary__add"),isDisabled:!C,onReset:u})]})}),(0,t.Y)(l.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:P?(0,s.localizationKeys)("userProfile.emailAddressPage.emailLink.formSubtitle",{identifier:null===(o=g.current)||void 0===o?void 0:o.emailAddress}):(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:null===(r=g.current)||void 0===r?void 0:r.emailAddress}),children:P?(0,t.Y)(E,{nextStep:d,email:g.current,onReset:u}):(0,t.Y)($,{nextStep:d,identification:g.current,identifier:null===(a=g.current)||void 0===a?void 0:a.emailAddress,prepareVerification:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.prepareVerification({strategy:"email_code"})},onReset:u})})]})})),J=e=>{const{close:o}=(0,P.D5)();return(0,t.Y)(S,{onSuccess:o,onReset:o,...e})},U=e=>{const{close:o}=(0,P.D5)();return(0,t.Y)(M,{onSuccess:o,onReset:o,...e})},W=({shouldAllowCreation:e=!0})=>{const{user:o}=(0,h.Jd)();return(0,t.Y)(l.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.title"),centered:!1,id:"emailAddresses",children:(0,t.Y)(v.r.Root,{children:(0,t.FD)(l.ProfileSection.ItemList,{id:"emailAddresses",children:[L(null==o?void 0:o.emailAddresses,null==o?void 0:o.primaryEmailAddressId).map((e=>(0,t.FD)(v.r.Root,{children:[(0,t.FD)(l.ProfileSection.Item,{id:"emailAddresses",children:[(0,t.FD)(s.Flex,{sx:e=>({overflow:"hidden",gap:e.space.$1}),children:[(0,t.Y)(s.Text,{sx:e=>({color:e.colors.$colorText}),truncate:!0,children:e.emailAddress}),(null==o?void 0:o.primaryEmailAddressId)===e.id&&(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__primary")}),"verified"!==e.verification.status&&(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__unverified")})]}),(0,t.Y)(H,{email:e})]}),(0,t.Y)(v.r.Open,{value:"remove",children:(0,t.Y)(v.r.Card,{variant:"destructive",children:(0,t.Y)(J,{emailId:e.id})})}),(0,t.Y)(v.r.Open,{value:"verify",children:(0,t.Y)(v.r.Card,{children:(0,t.Y)(U,{emailId:e.id})})})]},e.emailAddress))),e&&(0,t.FD)(t.FK,{children:[(0,t.Y)(v.r.Trigger,{value:"add",children:(0,t.Y)(l.ProfileSection.ArrowButton,{id:"emailAddresses",localizationKey:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.primaryButton")})}),(0,t.Y)(v.r.Open,{value:"add",children:(0,t.Y)(v.r.Card,{children:(0,t.Y)(U,{})})})]})]})})})},H=({email:e})=>{const o=(0,l.useCardState)(),{user:r}=(0,h.Jd)(),{open:i}=(0,P.D5)(),n=(null==r?void 0:r.primaryEmailAddressId)===e.id,a="verified"===e.verification.status,c=[n&&!a?{label:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__primary"),onClick:()=>i("verify")}:null,!n&&a?{label:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__nonPrimary"),onClick:()=>null==r?void 0:r.update({primaryEmailAddressId:e.id}).catch((e=>(0,Y.H4)(e,[],o.setError)))}:null,n||a?null:{label:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__unverified"),onClick:()=>i("verify")},{label:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.destructiveAction"),isDestructive:!0,onClick:()=>i("remove")}].filter((e=>null!==e));return(0,t.Y)(l.ThreeDotsMenu,{actions:c})},q=()=>{const{user:e}=(0,h.Jd)(),{getSamlProviderLogoUrl:o,getSamlProviderName:r}=(0,g.jn)();return(0,t.Y)(l.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.enterpriseAccountsSection.title"),id:"enterpriseAccounts",centered:!1,children:(0,t.Y)(l.ProfileSection.ItemList,{id:"enterpriseAccounts",children:null==e?void 0:e.samlAccounts.map((e=>{var i,n;const a=e.emailAddress,c=r(e.provider),d=o(e.provider),u=null===(n=null===(i=e.verification)||void 0===i?void 0:i.error)||void 0===n?void 0:n.longMessage;return(0,t.FD)(l.ProfileSection.Item,{id:"enterpriseAccounts",sx:e=>({gap:e.space.$2,justifyContent:"start"}),children:[(0,t.Y)(s.Image,{elementDescriptor:[s.descriptors.providerIcon],elementId:s.descriptors.enterpriseButtonsProviderIcon.setId(e.provider),alt:c,src:d,sx:e=>({width:e.sizes.$4})}),(0,t.Y)(s.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,t.FD)(s.Flex,{gap:2,center:!0,children:[(0,t.Y)(s.Text,{truncate:!0,colorScheme:"body",children:c}),(0,t.Y)(s.Text,{truncate:!0,as:"span",colorScheme:"secondary",children:a?`• ${a}`:""}),u&&(0,t.Y)(s.Badge,{colorScheme:"danger",localizationKey:(0,s.localizationKeys)("badge__requiresAction")})]})})]},e.id)}))})})},V=(0,l.withCardStateProvider)((e=>{const{phoneId:o,onSuccess:r,onReset:n}=e,{user:l}=(0,h.Jd)(),a=i.useRef(null==l?void 0:l.phoneNumbers.find((e=>e.id===o))),c=(0,p.Xi)({defaultStep:a.current?1:0});return(0,t.FD)(p.sQ,{...c.props,children:[(0,t.Y)(j,{resourceRef:a,title:(0,s.localizationKeys)("userProfile.phoneNumberPage.title"),onSuccess:c.nextStep,onReset:n}),(0,t.Y)(G,{resourceRef:a,title:(0,s.localizationKeys)("userProfile.phoneNumberPage.verifyTitle"),onSuccess:r,onReset:n})]})})),j=e=>{var o;const{title:r,onSuccess:i,onReset:n,onUseExistingNumberClick:a,resourceRef:c}=e,d=(0,l.useCardState)(),{user:u}=(0,h.Jd)(),{handleAssurance:m}=(0,y.r)(),f=(0,Y.tJ)("phoneNumber","",{type:"tel",label:(0,s.localizationKeys)("formFieldLabel__phoneNumber"),isRequired:!0}),p=f.value.length>1&&(null==u?void 0:u.username)!==f.value,v=!!(null===(o=null==u?void 0:u.phoneNumbers)||void 0===o?void 0:o.length)&&a;return(0,t.Y)(l.FormContainer,{headerTitle:r,gap:1,children:(0,t.FD)(l.Form.Root,{gap:4,onSubmit:async e=>{if(e.preventDefault(),u)return m((()=>u.createPhoneNumber({phoneNumber:f.value}))).then((e=>{c.current=e,i()})).catch((e=>(0,Y.H4)(e,[f],d.setError)))},children:[(0,t.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.phoneNumberPage.infoText"),colorScheme:"secondary"}),(0,t.Y)(l.Form.ControlRow,{elementId:f.id,children:(0,t.Y)(l.Form.PhoneInput,{...f.props,autoFocus:!0})}),(0,t.FD)(s.Flex,{justify:v?"between":"end",children:[v&&(0,t.Y)(s.Button,{variant:"ghost",localizationKey:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.backButton"),onClick:a}),(0,t.Y)(l.FormButtons,{submitLabel:(0,s.localizationKeys)("userProfile.formButtonPrimary__add"),isDisabled:!p,onReset:n})]})]})})},G=e=>{var o,r,i;const{title:n,onSuccess:a,resourceRef:c,onReset:d}=e;return(0,t.Y)(l.FormContainer,{headerTitle:n,headerSubtitle:(0,s.localizationKeys)("userProfile.phoneNumberPage.verifySubtitle",{identifier:null===(o=c.current)||void 0===o?void 0:o.phoneNumber}),children:(0,t.Y)($,{nextStep:a,identification:c.current,identifier:null===(r=c.current)||void 0===r?void 0:r.phoneNumber,prepareVerification:null===(i=c.current)||void 0===i?void 0:i.prepareVerification,onReset:d})})},Q=e=>{const{close:o}=(0,P.D5)();return(0,t.Y)(C,{onSuccess:o,onReset:o,...e})},X=e=>{const{close:o}=(0,P.D5)();return(0,t.Y)(V,{onSuccess:o,onReset:o,...e})},Z=({shouldAllowCreation:e=!0})=>{var o;const{user:r}=(0,h.Jd)(),i=Boolean(null===(o=null==r?void 0:r.phoneNumbers)||void 0===o?void 0:o.length);return e||i?(0,t.Y)(l.ProfileSection.Root,{centered:!1,title:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.title"),id:"phoneNumbers",children:(0,t.Y)(v.r.Root,{children:(0,t.FD)(l.ProfileSection.ItemList,{id:"phoneNumbers",children:[L(null==r?void 0:r.phoneNumbers,null==r?void 0:r.primaryPhoneNumberId).map((e=>(0,t.FD)(v.r.Root,{children:[(0,t.Y)(v.r.Closed,{value:"",children:(0,t.FD)(l.ProfileSection.Item,{id:"phoneNumbers",children:[(0,t.Y)(s.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,t.FD)(s.Flex,{gap:2,center:!0,children:[(0,t.Y)(s.Text,{sx:e=>({color:e.colors.$colorText}),children:(0,Y.Om)(e.phoneNumber)}),(null==r?void 0:r.primaryPhoneNumberId)===e.id&&(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__primary")}),"verified"!==e.verification.status&&(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__unverified")})]})}),(0,t.Y)(ee,{phone:e})]})}),(0,t.Y)(v.r.Open,{value:"remove",children:(0,t.Y)(v.r.Card,{variant:"destructive",children:(0,t.Y)(Q,{phoneId:e.id})})}),(0,t.Y)(v.r.Open,{value:"verify",children:(0,t.Y)(v.r.Card,{children:(0,t.Y)(X,{phoneId:e.id})})})]},e.id))),e&&(0,t.FD)(t.FK,{children:[(0,t.Y)(v.r.Trigger,{value:"add",children:(0,t.Y)(l.ProfileSection.ArrowButton,{id:"phoneNumbers",localizationKey:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.primaryButton")})}),(0,t.Y)(v.r.Open,{value:"add",children:(0,t.Y)(v.r.Card,{children:(0,t.Y)(X,{})})})]})]})})}):null},ee=({phone:e})=>{const o=(0,l.useCardState)(),{open:r}=(0,P.D5)(),{user:i}=(0,h.Jd)();if(!i)return null;const n=i.primaryPhoneNumberId===e.id,a="verified"===e.verification.status,c=[n&&!a?{label:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__primary"),onClick:()=>r("verify")}:null,!n&&a?{label:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__nonPrimary"),onClick:()=>i.update({primaryPhoneNumberId:e.id}).catch((e=>(0,Y.H4)(e,[],o.setError)))}:null,n||a?null:{label:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__unverified"),onClick:()=>r("verify")},{label:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.destructiveAction"),isDestructive:!0,onClick:()=>r("remove")}].filter((e=>null!==e));return(0,t.Y)(l.ThreeDotsMenu,{actions:c})};var oe=r(3965);const re=(0,l.withCardStateProvider)((e=>{const{onSuccess:o,onReset:r}=e,{handleAssurance:i}=(0,y.r)(),{user:a}=(0,h.Jd)();if(!a)return null;const{userSettings:c}=(0,n.useEnvironment)(),d=(0,l.useCardState)(),u=(0,Y.tJ)("username",a.username||"",{type:"text",label:(0,s.localizationKeys)("formFieldLabel__username"),placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__username")}),m=c.attributes.username.required,f=(!m||u.value.length>0)&&a.username!==u.value;return(0,t.Y)(l.FormContainer,{headerTitle:a.username?(0,s.localizationKeys)("userProfile.usernamePage.title__update"):(0,s.localizationKeys)("userProfile.usernamePage.title__set"),children:(0,t.FD)(l.Form.Root,{onSubmit:async()=>{try{await i((()=>a.update({username:u.value}))),o()}catch(e){(0,Y.H4)(e,[u],d.setError)}},children:[(0,t.Y)(l.Form.ControlRow,{elementId:u.id,children:(0,t.Y)(l.Form.PlainInput,{...u.props,autoFocus:!0,isRequired:m})}),(0,t.Y)(l.FormButtons,{isDisabled:!f,onReset:r})]})})})),te=()=>{const{close:e}=(0,P.D5)();return(0,t.Y)(re,{onSuccess:e,onReset:e})},ie=()=>{const{user:e}=(0,h.Jd)();return e?(0,t.Y)(l.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.usernameSection.title"),id:"username",sx:{alignItems:"center",[oe.mqu.md]:{alignItems:"flex-start"}},children:(0,t.FD)(v.r.Root,{children:[(0,t.Y)(v.r.Closed,{value:"edit",children:(0,t.FD)(l.ProfileSection.Item,{id:"username",sx:{paddingLeft:e.username?void 0:"0"},children:[e.username&&(0,t.Y)(s.Text,{truncate:!0,sx:e=>({color:e.colors.$colorText}),children:e.username}),(0,t.Y)(v.r.Trigger,{value:"edit",children:(0,t.Y)(l.ProfileSection.Button,{id:"username",localizationKey:e.username?(0,s.localizationKeys)("userProfile.start.usernameSection.primaryButton__updateUsername"):(0,s.localizationKeys)("userProfile.start.usernameSection.primaryButton__setUsername")})})]})}),(0,t.Y)(v.r.Open,{value:"edit",children:(0,t.Y)(v.r.Card,{children:(0,t.Y)(te,{})})})]})}):null},ne=e=>{const{user:o,...r}=e;return(0,t.Y)(l.AvatarUploader,{...r,title:(0,c.GQ)("userProfile.profilePage.imageFormTitle"),avatarPreview:(0,t.Y)(l.UserAvatar,{size:e=>e.sizes.$12,...o})})},se=(0,l.withCardStateProvider)((e=>{const{onSuccess:o,onReset:r}=e,i=(0,l.useCardState)(),{user:a}=(0,h.Jd)();if(!a)return null;const{first_name:c,last_name:d}=(0,n.useEnvironment)().userSettings.attributes,u=c.enabled,m=d.enabled,p=a.firstName||"",v=a.lastName||"",P=(0,Y.tJ)("firstName",a.firstName||"",{type:"text",label:(0,s.localizationKeys)("formFieldLabel__firstName"),placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__firstName"),isRequired:d.required}),g=(0,Y.tJ)("lastName",a.lastName||"",{type:"text",label:(0,s.localizationKeys)("formFieldLabel__lastName"),placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__lastName"),isRequired:d.required}),y=u&&P.value!==p||m&&g.value!==v,b=y,S=u&&c.required||m&&d.required,C=S&&!!g.value&&!!P.value&&b,z=a.samlAccounts.some((e=>e.active));return(0,t.FD)(l.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.profilePage.title"),children:[z&&(0,t.Y)(l.InformationBox,{message:(0,s.localizationKeys)("userProfile.profilePage.readonly")}),(0,t.FD)(l.Form.Root,{onSubmit:async e=>(e.preventDefault(),(y?a.update({firstName:P.value,lastName:g.value}):Promise.resolve()).then(o).catch((e=>{(0,Y.H4)(e,[P,g],i.setError)}))),sx:e=>({gap:e.space.$6}),children:[(0,t.Y)(ne,{user:a,onAvatarChange:e=>a.setProfileImage({file:e}).then((()=>{i.setIdle()})).catch((e=>(0,Y.H4)(e,[],i.setError))),onAvatarRemove:(0,f.px)(a.imageUrl)?null:()=>{a.setProfileImage({file:null}).then((()=>{i.setIdle()})).catch((e=>(0,Y.H4)(e,[],i.setError)))}}),(u||m)&&(0,t.FD)(l.Form.ControlRow,{elementId:"name",children:[u&&(0,t.Y)(l.Form.PlainInput,{...P.props,isDisabled:z,autoFocus:!0}),m&&(0,t.Y)(l.Form.PlainInput,{...g.props,isDisabled:z,autoFocus:!u})]}),(0,t.Y)(l.FormButtons,{isDisabled:S?!C:!b,onReset:r})]})]})})),le=()=>{const{close:e}=(0,P.D5)();return(0,t.Y)(se,{onSuccess:e,onReset:e})},ae=()=>{const{user:e}=(0,h.Jd)();if(!e)return null;const{username:o,primaryEmailAddress:r,primaryPhoneNumber:i,...n}=e;return(0,t.Y)(l.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.profileSection.title"),id:"profile",sx:{[oe.mqu.md]:{alignItems:"flex-start"}},children:(0,t.FD)(v.r.Root,{children:[(0,t.Y)(v.r.Closed,{value:"edit",children:(0,t.FD)(l.ProfileSection.Item,{id:"profile",children:[(0,t.Y)(l.UserPreview,{user:n,size:"lg",mainIdentifierVariant:"subtitle",sx:e=>({color:e.colors.$colorText})}),(0,t.Y)(v.r.Trigger,{value:"edit",children:(0,t.Y)(l.ProfileSection.Button,{id:"profile",localizationKey:(0,s.localizationKeys)("userProfile.start.profileSection.primaryButton")})})]})}),(0,t.Y)(v.r.Open,{value:"edit",children:(0,t.Y)(v.r.Card,{children:(0,t.Y)(le,{})})})]})})};var ce=r(7199);const de=(0,l.withCardStateProvider)((()=>{const e=(0,l.useCardState)(),{user:o}=(0,h.Jd)(),{strategies:r,strategyToDisplayData:i}=(0,g.kF)(),n=r.filter((e=>e.startsWith("web3"))),a=null==o?void 0:o.verifiedWeb3Wallets.map((e=>e.verification.strategy)),c=n.filter((e=>!a.includes(e)));return 0===c.length?null:(0,t.Y)(l.ProfileSection.ActionMenu,{id:"web3Wallets",triggerLocalizationKey:(0,s.localizationKeys)("userProfile.start.web3WalletsSection.primaryButton"),children:c.map((r=>(0,t.Y)(l.ProfileSection.ActionMenuItem,{id:i[r].id,onClick:()=>(async r=>{const t=r.replace("web3_","").replace("_signature","");try{e.setLoading(r);const i=await(0,ce.hz)({provider:t});if(!o)throw new Error("user is not defined");let n=await o.createWeb3Wallet({web3Wallet:i});n=await n.prepareVerification({strategy:r});const s=n.verification.nonce,l=await(0,ce.$t)({identifier:i,nonce:s,provider:t});await n.attemptVerification({signature:l}),e.setIdle()}catch(i){e.setIdle();const o=(0,Y.hG)(i);o?e.setError(o.longMessage):(0,Y.H4)(i,[],e.setError)}})(r),isLoading:e.loadingMetadata===r,isDisabled:e.isLoading,localizationKey:(0,s.localizationKeys)("userProfile.web3WalletPage.web3WalletButtonsBlockButton",{provider:i[r].name}),sx:e=>({justifyContent:"start",gap:e.space.$2}),leftIcon:(0,t.Y)(s.Image,{elementDescriptor:s.descriptors.providerIcon,elementId:s.descriptors.providerIcon.setId(i[r].id),isLoading:e.loadingMetadata===r,isDisabled:e.isLoading,src:i[r].iconUrl,alt:`Connect ${i[r].name}`,sx:e=>({width:e.sizes.$5})})},r)))})})),ue=e=>{const{close:o}=(0,P.D5)();return(0,t.Y)(F,{onSuccess:o,onReset:o,...e})},me=(0,l.withCardStateProvider)((({shouldAllowCreation:e=!0})=>{var o;const{user:r}=(0,h.Jd)(),i=(0,l.useCardState)(),{strategyToDisplayData:n}=(0,g.kF)(),a=Boolean(null===(o=null==r?void 0:r.web3Wallets)||void 0===o?void 0:o.length);return e||a?(0,t.FD)(l.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.web3WalletsSection.title"),id:"web3Wallets",children:[(0,t.Y)(l.Card.Alert,{children:i.error}),(0,t.FD)(v.r.Root,{children:[(0,t.Y)(l.ProfileSection.ItemList,{id:"web3Wallets",children:null==r?void 0:r.web3Wallets.map((e=>{const o=e.verification.strategy;return n[o]&&(0,t.FD)(v.r.Root,{children:[(0,t.Y)(v.r.Closed,{value:"",children:(0,t.FD)(l.ProfileSection.Item,{id:"web3Wallets",align:"start",children:[(0,t.FD)(s.Flex,{sx:e=>({alignItems:"center",gap:e.space.$2,width:"100%"}),children:[n[o].iconUrl&&(0,t.Y)(s.Image,{src:n[o].iconUrl,alt:n[o].name,sx:e=>({width:e.sizes.$4})}),(0,t.Y)(s.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,t.FD)(s.Flex,{gap:2,justify:"start",children:[(0,t.FD)(s.Text,{children:[n[o].name," (",(i=e.web3Wallet,i.length<=10?i:i.slice(0,6)+"..."+i.slice(-4)),")"]}),(null==r?void 0:r.primaryWeb3WalletId)===e.id&&(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__primary")}),"verified"!==e.verification.status&&(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__unverified")})]})})]}),(0,t.Y)(he,{})]},e.id)}),(0,t.Y)(v.r.Open,{value:"remove",children:(0,t.Y)(v.r.Card,{variant:"destructive",children:(0,t.Y)(ue,{walletId:e.id})})})]},e.id);var i}))}),e&&(0,t.Y)(de,{})]})]}):null})),he=()=>{const{open:e}=(0,P.D5)(),o=[{label:(0,s.localizationKeys)("userProfile.start.web3WalletsSection.destructiveAction"),onClick:()=>e("remove")}].filter((e=>null!==e));return(0,t.Y)(l.ThreeDotsMenu,{actions:o})},fe=(0,l.withCardStateProvider)((()=>{var e;const{attributes:o,saml:r,social:i}=(0,n.useEnvironment)().userSettings,a=(0,l.useCardState)(),{user:c}=(0,h.Jd)(),d=o.username.enabled,u=o.email_address.enabled,m=o.phone_number.enabled,f=i&&Object.values(i).filter((e=>e.enabled)).length>0,p=r&&r.enabled&&c&&c.samlAccounts.length>0,v=o.web3_wallet.enabled,P=!p||!(null===(e=null==c?void 0:c.samlAccounts)||void 0===e?void 0:e.some((e=>{var o;return e.active&&(null===(o=e.samlConnection)||void 0===o?void 0:o.disableAdditionalIdentifications)})));return(0,t.Y)(s.Col,{elementDescriptor:s.descriptors.page,sx:e=>({gap:e.space.$8,color:e.colors.$colorText}),children:(0,t.FD)(s.Col,{elementDescriptor:s.descriptors.profilePage,elementId:s.descriptors.profilePage.setId("account"),children:[(0,t.Y)(l.Header.Root,{children:(0,t.Y)(l.Header.Title,{localizationKey:(0,s.localizationKeys)("userProfile.start.headerTitle__account"),sx:e=>({marginBottom:e.space.$4}),textVariant:"h2"})}),(0,t.Y)(l.Card.Alert,{children:a.error}),(0,t.Y)(ae,{}),d&&(0,t.Y)(ie,{}),u&&(0,t.Y)(W,{shouldAllowCreation:P}),m&&(0,t.Y)(Z,{shouldAllowCreation:P}),f&&(0,t.Y)(w,{shouldAllowCreation:P}),p&&(0,t.Y)(q,{}),v&&(0,t.Y)(me,{shouldAllowCreation:P})]})})}));var pe=r(8313);const ve=()=>{const{user:e}=(0,h.Jd)(),{session:o}=(0,h.wV)(),{data:r,isLoading:i}=(0,g.st)(null==e?void 0:e.getSessions,"user-sessions");return(0,t.Y)(l.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.activeDevicesSection.title"),centered:!1,id:"activeDevices",children:(0,t.Y)(l.ProfileSection.ItemList,{id:"activeDevices",disableAnimation:!0,children:i?(0,t.Y)(l.FullHeightLoader,{}):null==r?void 0:r.sort((n=o.id,e=>e.id===n?-1:1)).map((e=>"active"!==e.status?null:(0,t.Y)(Pe,{session:e},e.id)))})});var n},Pe=({session:e})=>{var o;const r=(null===(o=(0,h.wV)().session)||void 0===o?void 0:o.id)===e.id,i=(0,g.mN)(),{handleAssurance:n}=(0,y.r)();return(0,t.FD)(l.ProfileSection.Item,{id:"activeDevices",elementDescriptor:s.descriptors.activeDeviceListItem,elementId:r?s.descriptors.activeDeviceListItem.setId("current"):void 0,sx:{alignItems:"flex-start"},children:[i.isLoading&&(0,t.Y)(l.FullHeightLoader,{}),!i.isLoading&&(0,t.FD)(t.FK,{children:[(0,t.Y)(ge,{session:e}),!r&&(0,t.Y)(ye,{revoke:async()=>{if(!r&&e)return i.setLoading(),n((()=>e.revoke())).catch((()=>{})).finally((()=>i.setIdle()))}})]})]})},ge=e=>{const{session:o}=(0,h.wV)(),r=(null==o?void 0:o.id)===e.session.id,i=!!(null==o?void 0:o.actor),n=!!e.session.actor,{city:l,country:a,browserName:c,browserVersion:d,deviceType:u,ipAddress:m,isMobile:f}=e.session.latestActivity,p=u||(f?"Mobile device":"Desktop device"),v=`${c||""} ${d||""}`.trim()||"Web browser",P=[l||"",a||""].filter(Boolean).join(", ").trim()||null,{t:g}=(0,s.useLocalizations)();return(0,t.FD)(s.Flex,{elementDescriptor:s.descriptors.activeDevice,elementId:r?s.descriptors.activeDevice.setId("current"):void 0,sx:e=>({width:"100%",overflow:"hidden",gap:e.space.$4,[oe.mqu.sm]:{gap:e.space.$2}}),children:[(0,t.Y)(s.Flex,{sx:e=>({[oe.mqu.sm]:{padding:"0"},borderRadius:e.radii.$md}),children:(0,t.Y)(s.Icon,{elementDescriptor:s.descriptors.activeDeviceIcon,elementId:s.descriptors.activeDeviceIcon.setId(f?"mobile":"desktop"),icon:f?pe.R2:pe.rI,sx:e=>({"--cl-chassis-bottom":"#444444","--cl-chassis-back":"#343434","--cl-chassis-screen":"#575757","--cl-screen":"#000000",width:e.space.$8,height:e.space.$8})})}),(0,t.FD)(s.Col,{align:"start",gap:1,children:[(0,t.FD)(s.Flex,{center:!0,gap:2,children:[(0,t.Y)(s.Text,{children:p}),r&&(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__thisDevice"),colorScheme:i?"danger":"primary"}),i&&!n&&(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__userDevice")}),!r&&n&&(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__otherImpersonatorDevice"),colorScheme:"danger"})]}),(0,t.Y)(s.Text,{colorScheme:"secondary",children:v}),(0,t.FD)(s.Text,{colorScheme:"secondary",children:[m," (",P,")"]}),(0,t.Y)(s.Text,{colorScheme:"secondary",children:g((0,Y.T$)(e.session.lastActiveAt))})]})]})},ye=({revoke:e})=>{const o=[{label:(0,s.localizationKeys)("userProfile.start.activeDevicesSection.destructiveAction"),isDestructive:!0,onClick:e}].filter((e=>null!==e));return(0,t.Y)(l.ThreeDotsMenu,{actions:o})};var Ye=r(9029);const be=(0,l.withCardStateProvider)((e=>{const{onReset:o}=e,r=(0,l.useCardState)(),{navigateAfterSignOut:i,navigateAfterMultiSessionSingleSignOutUrl:a}=(0,n.useSignOutContext)(),{user:c}=(0,h.Jd)(),{t:d}=(0,s.useLocalizations)(),{otherSessions:u}=(0,Ye.z)({user:c}),{setActive:m}=(0,h.ho)(),{handleAssurance:f}=(0,y.r)(),p=(0,Y.tJ)("deleteConfirmation","",{type:"text",label:(0,s.localizationKeys)("userProfile.deletePage.actionDescription"),isRequired:!0,placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__confirmDeletionUserAccount")}),v=p.value===(d((0,s.localizationKeys)("formFieldInputPlaceholder__confirmDeletionUserAccount"))||"Delete account");return(0,t.Y)(l.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.deletePage.title"),sx:e=>({gap:e.space.$0x5}),children:(0,t.FD)(l.Form.Root,{onSubmit:async()=>{if(v)try{if(!c)throw Error("user is not defined");await f(c.delete);const e=0===u.length?i:a;return await m({session:null,beforeEmit:e})}catch(e){(0,Y.H4)(e,[],r.setError)}},children:[(0,t.FD)(s.Col,{gap:1,children:[(0,t.Y)(s.Text,{colorScheme:"secondary",localizationKey:(0,s.localizationKeys)("userProfile.deletePage.messageLine1")}),(0,t.Y)(s.Text,{colorScheme:"danger",localizationKey:(0,s.localizationKeys)("userProfile.deletePage.messageLine2")})]}),(0,t.Y)(l.Form.ControlRow,{elementId:p.id,children:(0,t.Y)(l.Form.PlainInput,{...p.props,ignorePasswordManager:!0})}),(0,t.Y)(l.FormButtons,{submitLabel:(0,s.localizationKeys)("userProfile.deletePage.confirm"),colorScheme:"danger",isDisabled:!v,onReset:o})]})})})),Se=()=>{const{close:e}=(0,P.D5)();return(0,t.Y)(be,{onSuccess:e,onReset:e})},Ce=()=>(0,t.Y)(l.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.dangerSection.title"),id:"danger",sx:{alignItems:"center",[oe.mqu.md]:{alignItems:"flex-start"}},children:(0,t.FD)(v.r.Root,{children:[(0,t.Y)(v.r.Closed,{value:"delete",children:(0,t.Y)(l.ProfileSection.Item,{id:"danger",sx:e=>({paddingLeft:e.space.$1}),children:(0,t.Y)(v.r.Trigger,{value:"delete",children:(0,t.Y)(l.ProfileSection.Button,{id:"danger",variant:"ghost",colorScheme:"danger",localizationKey:(0,s.localizationKeys)("userProfile.start.dangerSection.deleteAccountButton")})})})}),(0,t.Y)(v.r.Open,{value:"delete",children:(0,t.Y)(v.r.Card,{variant:"destructive",children:(0,t.Y)(Se,{})})})]})});var ze=r(8740);const Fe=e=>{const{code:o}=e;return(0,t.Y)(s.Flex,{center:!0,sx:e=>({padding:`${e.space.$1} ${e.space.$4}`}),children:(0,t.Y)(s.Text,{children:o})})},Ke=e=>{const{subtitle:o,backupCodes:r}=e,{applicationName:i}=(0,n.useEnvironment)().displayConfig,{user:l}=(0,h.Jd)(),{print:a,printableProps:c}=(0,p.hH)(),{onCopy:d,hasCopied:u}=(0,g.iD)((null==r?void 0:r.join(","))||"");if(!l)return null;const m=(0,ze.Cm)(l);return r?(0,t.FD)(t.FK,{children:[(0,t.FD)(s.Col,{gap:1,children:[(0,t.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.backupCodePage.title__codelist"),variant:"subtitle"}),(0,t.Y)(s.Text,{localizationKey:o,variant:"caption",colorScheme:"secondary"})]}),(0,t.FD)(s.Box,{sx:e=>({borderWidth:e.borderWidths.$normal,borderStyle:e.borderStyles.$solid,borderColor:e.colors.$neutralAlpha100,borderRadius:e.radii.$lg}),children:[(0,t.Y)(s.Grid,{gap:2,sx:e=>({gridTemplateColumns:`repeat(2, minmax(${e.sizes.$12}, 1fr))`,padding:`${e.space.$4} ${e.space.$6}`}),children:r.map(((e,o)=>(0,t.Y)(Fe,{code:e},o)))}),(0,t.FD)(s.Grid,{sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$neutralAlpha100,gridTemplateColumns:"repeat(3, minmax(0, 1fr))",">:not([hidden])~:not([hidden])":{borderRightWidth:"0px",borderLeftWidth:"1px",borderStyle:"solid",borderColor:e.colors.$neutralAlpha100},">:first-child":{borderBottomLeftRadius:e.radii.$lg},">:last-child":{borderBottomRightRadius:e.radii.$lg}}),children:[(0,t.Y)(s.Button,{variant:"ghost",sx:e=>({width:"100%",padding:`${e.space.$2} 0`,borderRadius:0}),onClick:()=>{const e=document.createElement("a"),o=new Blob([Re(r,i,m)],{type:"text/plain"});e.href=URL.createObjectURL(o),e.download=`${i}_backup_codes.txt`,document.body.appendChild(e),e.click()},children:(0,t.Y)(s.Icon,{icon:pe.f5})}),(0,t.Y)(s.Button,{variant:"ghost",sx:e=>({width:"100%",padding:`${e.space.$2} 0`,borderRadius:0}),onClick:a,children:(0,t.Y)(s.Icon,{icon:pe.aS})}),(0,t.Y)(s.Button,{variant:"ghost",onClick:d,sx:e=>({width:"100%",padding:`${e.space.$2} 0`,borderRadius:0}),children:(0,t.Y)(s.Icon,{icon:u?pe.Jl:pe.QR})})]})]}),(0,t.FD)(p.LS,{...c,children:[(0,t.FD)(s.Heading,{children:["Your backup codes for ",i," account ",m,":"]}),(0,t.Y)(s.Col,{gap:2,children:r.map(((e,o)=>(0,t.Y)(Fe,{code:e},o)))})]})]}):null};function Re(e,o,r){return`These are your backup codes for ${o} account ${r}.\nStore them securely and keep them secret. Each code can only be used once.\n\n${null==e?void 0:e.join("\n")}`}const De=(0,l.withCardStateProvider)((e=>{const{onSuccess:o}=e,{user:r}=(0,h.Jd)(),n=(0,l.useCardState)(),{handleAssurance:a}=(0,y.r)(),[c,d]=i.useState(void 0);return i.useEffect((()=>{!c&&r&&a(r.createBackupCode).then((e=>d(e))).catch((e=>(0,Y.H4)(e,[],n.setError)))}),[]),n.error?(0,t.Y)(l.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.backupCodePage.title")}):(0,t.Y)(l.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.backupCodePage.title"),children:c?(0,t.FD)(t.FK,{children:[(0,t.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.backupCodePage.successMessage")}),(0,t.Y)(Ke,{subtitle:(0,s.localizationKeys)("userProfile.backupCodePage.subtitle__codelist"),backupCodes:c.codes}),(0,t.Y)(l.FormButtonContainer,{children:(0,t.Y)(s.Button,{autoFocus:!0,onClick:o,localizationKey:(0,s.localizationKeys)("userProfile.formButtonPrimary__finish"),elementDescriptor:s.descriptors.formButtonPrimary})})]}):(0,t.Y)(l.FullHeightLoader,{})})})),xe=(0,l.withCardStateProvider)((e=>{const{onSuccess:o,onReset:r}=e,i=(0,p.Xi)();return(0,t.FD)(p.sQ,{...i.props,children:[(0,t.Y)(_e,{onContinue:i.nextStep}),(0,t.Y)(De,{onSuccess:o,onReset:r})]})})),_e=e=>{const{onContinue:o}=e,{close:r}=(0,P.D5)();return(0,t.FD)(l.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.backupCodePage.title"),children:[(0,t.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.backupCodePage.infoText1")}),(0,t.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.backupCodePage.infoText2")}),(0,t.FD)(l.FormButtonContainer,{sx:{marginTop:0},children:[(0,t.Y)(s.Button,{textVariant:"buttonSmall",onClick:o,localizationKey:(0,s.localizationKeys)("userProfile.formButtonPrimary__finish"),elementDescriptor:s.descriptors.formButtonPrimary}),(0,t.Y)(s.Button,{variant:"ghost",onClick:r,localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset})]})]})},we=(0,l.withCardStateProvider)((e=>{var o;const{onReset:r,onSuccess:a}=e,c=i.useRef(),d=(0,p.Xi)({defaultStep:2}),u=(0,n.useEnvironment)().userSettings.attributes.backup_code.enabled;return(0,t.FD)(p.sQ,{...d.props,children:[(0,t.Y)(j,{title:(0,s.localizationKeys)("userProfile.phoneNumberPage.title"),resourceRef:c,onSuccess:d.nextStep,onUseExistingNumberClick:()=>d.goToStep(2),onReset:r}),(0,t.Y)(G,{title:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.title"),resourceRef:c,onSuccess:d.nextStep,onReset:()=>d.goToStep(2)}),(0,t.Y)(Te,{onSuccess:u?d.nextStep:a,onReset:r,onAddPhoneClick:()=>d.goToStep(0),onUnverifiedPhoneClick:e=>{c.current=e,d.goToStep(1)},title:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.title"),resourceRef:c}),u&&(0,t.Y)(l.SuccessPage,{title:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.successTitle"),text:[(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.successMessage1"),(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.successMessage2")],onFinish:r,contents:(0,t.Y)(Ke,{backupCodes:null===(o=c.current)||void 0===o?void 0:o.backupCodes})})]})})),Te=e=>{const{onSuccess:o,onReset:r,title:i,onAddPhoneClick:n,onUnverifiedPhoneClick:a,resourceRef:c}=e,d=(0,l.useCardState)(),{user:u}=(0,h.Jd)(),{handleAssurance:m}=(0,y.r)();if(!u)return null;const f=u.phoneNumbers.filter((e=>!e.reservedForSecondFactor));return(0,t.FD)(l.FormContainer,{headerTitle:i,gap:1,children:[(0,t.Y)(s.Text,{localizationKey:(0,s.localizationKeys)(f.length?"userProfile.mfaPhoneCodePage.subtitle__availablePhoneNumbers":"userProfile.mfaPhoneCodePage.subtitle__unavailablePhoneNumbers"),colorScheme:"secondary"}),f.length>0&&(0,t.Y)(s.Col,{gap:2,children:f.map((e=>{const{country:r}=(0,Y.Mz)(e.phoneNumber),i=(0,Y.Om)(e.phoneNumber);return(0,t.FD)(s.Button,{variant:"outline",colorScheme:"neutral",sx:{justifyContent:"start"},onClick:()=>(async e=>{if("verified"!==e.verification.status)return a(e);d.setLoading(e.id);try{await m((()=>e.setReservedForSecondFactor({reserved:!0}))),c.current=e,o()}catch(r){(0,Y.H4)(r,[],d.setError)}finally{d.setIdle()}})(e),isLoading:d.loadingMetadata===e.id,isDisabled:d.isLoading,children:[r.iso.toUpperCase()," ",i]},e.id)}))}),(0,t.FD)(l.FormButtonContainer,{sx:{flexDirection:"row",justifyContent:"space-between"},children:[(0,t.Y)(l.IconButton,{variant:"ghost","aria-label":"Add phone number",icon:(0,t.Y)(s.Icon,{icon:pe.FW,sx:e=>({marginRight:e.space.$2})}),localizationKey:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.primaryButton__addPhoneNumber"),onClick:n}),(0,t.Y)(s.Button,{variant:"ghost",localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),onClick:r})]})]})};var Ae=r(1732);const ke=(0,l.withCardStateProvider)((e=>{const{title:o,onSuccess:r,onReset:n}=e,{user:a}=(0,h.Jd)(),c=(0,l.useCardState)(),{handleAssurance:d}=(0,y.r)(),{close:u}=(0,P.D5)(),[m,f]=i.useState(void 0),[v,g]=i.useState("qr");return i.useEffect((()=>{a&&d(a.createTOTP).then((e=>f(e))).catch((e=>(0,Ae.Cm)(e)&&"assurance_cancelled"===e.code?u():(0,Y.H4)(e,[],c.setError)))}),[]),c.error?(0,t.Y)(l.FormContainer,{headerTitle:o}):(0,t.FD)(l.FormContainer,{headerTitle:o,headerSubtitle:"qr"==v?(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.infoText__ableToScan"):(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.infoText__unableToScan"),children:[!m&&(0,t.Y)(l.FullHeightLoader,{}),m&&(0,t.FD)(t.FK,{children:[(0,t.FD)(s.Col,{gap:4,children:["qr"==v&&(0,t.Y)(p.rg,{justify:"center",url:m.uri||""}),"uri"==v&&(0,t.FD)(t.FK,{children:[(0,t.Y)(s.Text,{colorScheme:"secondary",localizationKey:(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.inputLabel__unableToScan1")}),(0,t.Y)(l.ClipboardInput,{value:m.secret}),(0,t.Y)(s.Text,{colorScheme:"secondary",localizationKey:(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.inputLabel__unableToScan2")}),(0,t.Y)(l.ClipboardInput,{value:m.uri})]})]}),(0,t.FD)(s.Flex,{justify:"between",align:"center",sx:{width:"100%"},children:["qr"==v&&(0,t.Y)(s.Button,{variant:"link",textVariant:"buttonLarge",onClick:()=>g("uri"),localizationKey:(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.buttonUnableToScan__nonPrimary")}),"uri"==v&&(0,t.Y)(s.Button,{variant:"link",textVariant:"buttonLarge",onClick:()=>g("qr"),localizationKey:(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.buttonAbleToScan__nonPrimary")}),(0,t.FD)(l.FormButtonContainer,{children:[(0,t.Y)(s.Button,{onClick:r,localizationKey:(0,s.localizationKeys)("userProfile.formButtonPrimary__continue"),elementDescriptor:s.descriptors.formButtonPrimary}),(0,t.Y)(s.Button,{variant:"ghost",onClick:n,localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset})]})]})]})]})})),Ie=(0,l.withCardStateProvider)((e=>{const{onSuccess:o,onReset:r,resourceRef:i}=e,{user:n}=(0,h.Jd)(),a=(0,l.useFieldOTP)({onCodeEntryFinished:(e,o,r)=>{null==n||n.verifyTOTP({code:e}).then((e=>o(e))).catch(r)},onResolve:e=>{i.current=e,o()}});return(0,t.FD)(l.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.mfaTOTPPage.title"),children:[(0,t.Y)(s.Col,{children:(0,t.Y)(l.Form.OTPInput,{...a,label:(0,s.localizationKeys)("userProfile.mfaTOTPPage.verifyTitle"),description:(0,s.localizationKeys)("userProfile.mfaTOTPPage.verifySubtitle")})}),(0,t.Y)(l.FormButtonContainer,{sx:{marginTop:0},children:(0,t.Y)(s.Button,{onClick:r,variant:"ghost",isDisabled:a.isLoading,localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset})})]})})),Be=(0,l.withCardStateProvider)((e=>{var o;const{onReset:r}=e,n=(0,p.Xi)(),a=i.useRef();return(0,t.FD)(p.sQ,{...n.props,children:[(0,t.Y)(ke,{title:(0,s.localizationKeys)("userProfile.mfaTOTPPage.title"),onSuccess:n.nextStep,onReset:r}),(0,t.Y)(Ie,{onSuccess:n.nextStep,onReset:r,resourceRef:a}),(0,t.Y)(l.SuccessPage,{title:(0,s.localizationKeys)("userProfile.mfaTOTPPage.title"),text:(0,s.localizationKeys)("userProfile.mfaTOTPPage.successMessage"),onFinish:r,contents:(0,t.Y)(Ke,{subtitle:(0,s.localizationKeys)("userProfile.backupCodePage.successSubtitle"),backupCodes:null===(o=a.current)||void 0===o?void 0:o.backupCodes})})]})})),Le=(0,l.withCardStateProvider)((e=>{const{onSuccess:o,onReset:r,selectedStrategy:a}=e,c=(0,l.useCardState)(),{userSettings:{attributes:d}}=(0,n.useEnvironment)(),{user:u}=(0,h.Jd)();if(!u)return null;const m=(0,s.localizationKeys)("userProfile.mfaPage.title"),f=i.useMemo((()=>B(d,u)),[]);return i.useEffect((()=>{0===f.length&&c.setError("There are no second factors available to add")}),[]),c.error?(0,t.Y)(l.FormContainer,{headerTitle:m}):0!==f.length||a?(0,t.Y)($e,{onSuccess:o,onReset:r,method:a||f[0]}):null})),$e=e=>{const{method:o,onSuccess:r,onReset:i}=e;switch(o){case"phone_code":return(0,t.Y)(we,{onSuccess:r,onReset:i});case"totp":return(0,t.Y)(Be,{onSuccess:r,onReset:i});case"backup_code":return(0,t.Y)(xe,{onSuccess:r,onReset:i});default:return null}},Ne=()=>{const{close:e}=(0,P.D5)();return(0,t.Y)(R,{onSuccess:e,onReset:e})},Ee=e=>{const{close:o}=(0,P.D5)();return(0,t.Y)(K,{onSuccess:o,onReset:o,...e})},Oe=()=>{const{close:e}=(0,P.D5)();return(0,t.Y)(De,{onSuccess:e,onReset:e})},Me=e=>{const{close:o}=(0,P.D5)();return(0,t.Y)(Le,{onSuccess:o,onReset:o,selectedStrategy:e.selectedStrategy})},Je=()=>{const{userSettings:{attributes:e}}=(0,n.useEnvironment)(),{user:o}=(0,h.Jd)();if(!o)return null;const r=I(e),i=B(e,o),a=r.includes("totp")&&o.totpEnabled,c=r.includes("backup_code")&&o.backupCodeEnabled,d=o.phoneNumbers.filter((e=>"verified"===e.verification.status)).filter((e=>e.reservedForSecondFactor)).sort(k);return(0,t.Y)(l.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.mfaSection.title"),centered:!1,id:"mfa",children:(0,t.Y)(v.r.Root,{children:(0,t.FD)(l.ProfileSection.ItemList,{id:"mfa",children:[a&&(0,t.FD)(v.r.Root,{children:[(0,t.FD)(l.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,t.FD)(s.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,t.Y)(s.Icon,{icon:pe.c6,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,t.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.start.mfaSection.totp.headerTitle")}),(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__default")})]}),(0,t.Y)(He,{})]}),(0,t.Y)(v.r.Open,{value:"remove",children:(0,t.Y)(v.r.Card,{variant:"destructive",children:(0,t.Y)(Ne,{})})})]}),r.includes("phone_code")&&d.map((e=>{const o=!a&&e.defaultSecondFactor;return(0,t.FD)(v.r.Root,{children:[(0,t.FD)(l.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,t.FD)(s.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,t.Y)(s.Icon,{icon:pe.fq,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,t.FD)(s.Text,{children:["SMS Code ",(0,t.Y)(l.FormattedPhoneNumberText,{value:e.phoneNumber})]}),o&&(0,t.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__default")})]}),(0,t.Y)(Ue,{phone:e,showTOTP:a})]}),(0,t.Y)(v.r.Open,{value:"remove",children:(0,t.Y)(v.r.Card,{variant:"destructive",children:(0,t.Y)(Ee,{phoneId:e.id})})})]},e.id)})),c&&(0,t.FD)(v.r.Root,{children:[(0,t.FD)(l.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,t.FD)(s.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,t.Y)(s.Icon,{icon:pe.G6,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,t.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.start.mfaSection.backupCodes.headerTitle")})]}),(0,t.Y)(We,{})]}),(0,t.Y)(v.r.Open,{value:"regenerate",children:(0,t.Y)(v.r.Card,{children:(0,t.Y)(Oe,{})})})]}),(0,t.Y)(qe,{secondFactorsAvailableToAdd:i})]})})})},Ue=({phone:e,showTOTP:o})=>{const{open:r}=(0,P.D5)(),i=(0,l.useCardState)(),n=[o?null:{label:(0,s.localizationKeys)("userProfile.start.mfaSection.phoneCode.actionLabel__setDefault"),onClick:()=>e.makeDefaultSecondFactor().catch((e=>(0,Y.H4)(e,[],i.setError))),isDisabled:e.defaultSecondFactor},{label:(0,s.localizationKeys)("userProfile.start.mfaSection.phoneCode.destructiveActionLabel"),isDestructive:!0,onClick:()=>r("remove")}].filter((e=>null!==e));return(0,t.Y)(l.ThreeDotsMenu,{actions:n})},We=()=>{const{open:e}=(0,P.D5)(),o=[{label:(0,s.localizationKeys)("userProfile.start.mfaSection.backupCodes.actionLabel__regenerate"),onClick:()=>e("regenerate")}].filter((e=>null!==e));return(0,t.Y)(l.ThreeDotsMenu,{actions:o})},He=()=>{const{open:e}=(0,P.D5)(),o=[{label:(0,s.localizationKeys)("userProfile.start.mfaSection.totp.destructiveActionTitle"),isDestructive:!0,onClick:()=>e("remove")}].filter((e=>null!==e));return(0,t.Y)(l.ThreeDotsMenu,{actions:o})},qe=e=>{const{open:o}=(0,P.D5)(),{secondFactorsAvailableToAdd:r}=e,[n,a]=(0,i.useState)(),c=i.useMemo((()=>r.map((e=>"phone_code"===e?{icon:pe.fq,text:"SMS code",key:"phone_code"}:"totp"===e?{icon:pe.c6,text:"Authenticator application",key:"totp"}:"backup_code"===e?{icon:pe.G6,text:"Backup code",key:"backup_code"}:null)).filter((e=>null!==e))),[r]);return(0,t.FD)(t.FK,{children:[r.length>0&&(0,t.Y)(v.r.Closed,{value:"multi-factor",children:(0,t.Y)(l.ProfileSection.ActionMenu,{id:"mfa",triggerLocalizationKey:(0,s.localizationKeys)("userProfile.start.mfaSection.primaryButton"),children:c.map((e=>e&&(0,t.Y)(l.ProfileSection.ActionMenuItem,{id:e.key,localizationKey:e.text,leftIcon:e.icon,onClick:()=>{a(e.key),o("multi-factor")}},e.key)))})}),(0,t.Y)(v.r.Open,{value:"multi-factor",children:(0,t.Y)(v.r.Card,{children:n&&(0,t.Y)(Me,{selectedStrategy:n})})})]})},Ve=e=>{const{close:o}=(0,P.D5)();return(0,t.Y)(D,{onSuccess:o,onReset:o,...e})},je=e=>{const{close:o}=(0,P.D5)();return(0,t.Y)(Ge,{onSuccess:o,onReset:o,passkey:e.passkey})},Ge=(0,l.withCardStateProvider)((e=>{const{onSuccess:o,onReset:r,passkey:i}=e,n=(0,l.useCardState)(),a=(0,Y.tJ)("passkeyName",i.name||"",{type:"text",label:(0,s.localizationKeys)("formFieldLabel__passkeyName"),isRequired:!0}),c=a.value.length>1&&i.name!==a.value;return(0,t.Y)(l.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.passkeyScreen.title__rename"),headerSubtitle:(0,s.localizationKeys)("userProfile.passkeyScreen.subtitle__rename"),children:(0,t.FD)(l.Form.Root,{onSubmit:async e=>(e.preventDefault(),i.update({name:a.value}).then(o).catch((e=>(0,Y.H4)(e,[a],n.setError)))),children:[(0,t.Y)(l.Form.ControlRow,{elementId:a.id,children:(0,t.Y)(l.Form.PlainInput,{...a.props,autoComplete:"off"})}),(0,t.Y)(l.FormButtons,{submitLabel:(0,s.localizationKeys)("userProfile.formButtonPrimary__save"),isDisabled:!c,onReset:r})]})})})),Qe=()=>{const{user:e}=(0,h.Jd)();return e?(0,t.Y)(l.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.passkeysSection.title"),centered:!1,id:"passkeys",children:(0,t.FD)(l.ProfileSection.ItemList,{id:"passkeys",children:[e.passkeys.map((e=>(0,t.FD)(v.r.Root,{children:[(0,t.Y)(Xe,{...e},e.id),(0,t.Y)(v.r.Open,{value:"remove",children:(0,t.Y)(v.r.Card,{variant:"destructive",children:(0,t.Y)(Ve,{passkey:e})})}),(0,t.Y)(v.r.Open,{value:"rename",children:(0,t.Y)(v.r.Card,{children:(0,t.Y)(je,{passkey:e})})})]},e.id))),(0,t.Y)(oo,{})]})}):null},Xe=e=>(0,t.FD)(l.ProfileSection.Item,{id:"passkeys",hoverable:!0,sx:{alignItems:"flex-start"},children:[(0,t.Y)(Ze,{...e}),(0,t.Y)(eo,{})]}),Ze=e=>{const{name:o,createdAt:r,lastUsedAt:i}=e,{t:n}=(0,s.useLocalizations)();return(0,t.Y)(s.Flex,{sx:e=>({width:"100%",overflow:"hidden",gap:e.space.$4,[oe.mqu.sm]:{gap:e.space.$2}}),children:(0,t.FD)(s.Col,{align:"start",gap:1,children:[(0,t.Y)(s.Text,{children:o}),(0,t.FD)(s.Text,{colorScheme:"secondary",children:["Created: ",n((0,Y.T$)(r))]}),i&&(0,t.FD)(s.Text,{colorScheme:"secondary",children:["Last used: ",n((0,Y.T$)(i))]})]})})},eo=()=>{const{open:e}=(0,P.D5)(),o=[{label:(0,s.localizationKeys)("userProfile.start.passkeysSection.menuAction__rename"),onClick:()=>e("rename")},{label:(0,s.localizationKeys)("userProfile.start.passkeysSection.menuAction__destructive"),isDestructive:!0,onClick:()=>e("remove")}];return(0,t.Y)(l.ThreeDotsMenu,{actions:o})},oo=()=>{const e=(0,l.useCardState)(),{isSatellite:o}=(0,h.ho)(),{user:r}=(0,h.Jd)(),{handleAssurance:i}=(0,y.r)();return o?null:(0,t.Y)(l.ProfileSection.ArrowButton,{id:"passkeys",localizationKey:"Add a passkey",onClick:async()=>{if(r)try{await i(r.createPasskey)}catch(o){(0,Y.H4)(o,[],e.setError)}}})},ro=(e,o)=>{const r=[];return e?r.push((0,s.localizationKeys)("userProfile.passwordPage.successMessage__update")):r.push((0,s.localizationKeys)("userProfile.passwordPage.successMessage__set")),o&&r.push((0,s.localizationKeys)("userProfile.passwordPage.successMessage__signOutOfOtherSessions")),r},to=(0,l.withCardStateProvider)((e=>{const{onSuccess:o,onReset:r}=e,{user:a}=(0,h.Jd)(),{handleAssurance:c}=(0,y.r)();if(!a)return null;const{session:d}=(0,h.wV)(),u=a.passwordEnabled?(0,s.localizationKeys)("userProfile.passwordPage.title__update"):(0,s.localizationKeys)("userProfile.passwordPage.title__set"),m=(0,l.useCardState)(),f=a.samlAccounts.some((e=>e.active)),p=(0,i.useRef)({title:(0,s.localizationKeys)("userProfile.passwordPage.title__set")}),v=(0,Y.tJ)("currentPassword","",{type:"password",label:(0,s.localizationKeys)("formFieldLabel__currentPassword"),isRequired:!0}),{userSettings:{passwordSettings:P}}=(0,n.useEnvironment)(),b=(0,Y.tJ)("newPassword","",{type:"password",label:(0,s.localizationKeys)("formFieldLabel__newPassword"),isRequired:!0,validatePassword:!0,buildErrorMessage:e=>(0,Y.C5)(e,{t:K,locale:R,passwordSettings:P})}),S=(0,Y.tJ)("confirmPassword","",{type:"password",label:(0,s.localizationKeys)("formFieldLabel__confirmPassword"),isRequired:!0}),C=(0,Y.tJ)("signOutOfOtherSessions","",{type:"checkbox",label:(0,s.localizationKeys)("formFieldLabel__signOutOfOtherSessions"),defaultChecked:!0}),{setConfirmPasswordFeedback:z,isPasswordMatch:F}=(0,g.Zg)({passwordField:b,confirmPasswordField:S}),{t:K,locale:R}=(0,s.useLocalizations)(),D=(a.passwordEnabled?v.value&&F:F)&&b.value&&S.value;return(0,t.FD)(l.FormContainer,{headerTitle:u,children:[f&&(0,t.Y)(l.InformationBox,{message:(0,s.localizationKeys)("userProfile.passwordPage.readonly")}),(0,t.FD)(l.Form.Root,{onSubmit:async()=>{const e={newPassword:b.value,signOutOfOtherSessions:C.checked,currentPassword:a.passwordEnabled?v.value:void 0};try{p.current={title:a.passwordEnabled?(0,s.localizationKeys)("userProfile.passwordPage.title__update"):(0,s.localizationKeys)("userProfile.passwordPage.title__set"),text:ro(a.passwordEnabled,!!C.checked)},await c((()=>a.updatePassword(e))),o()}catch(r){(0,Y.H4)(r,[v,b,S],m.setError)}},onBlur:()=>{b.value&&z(S.value)},children:[(0,t.Y)("input",{readOnly:!0,"data-testid":"hidden-identifier",id:"identifier-field",name:"identifier",value:(null==d?void 0:d.publicUserData.identifier)||"",style:{display:"none"}}),a.passwordEnabled&&(0,t.Y)(l.Form.ControlRow,{elementId:v.id,children:(0,t.Y)(l.Form.PasswordInput,{...v.props,minLength:6,isRequired:!0,autoFocus:!0,isDisabled:f})}),(0,t.Y)(l.Form.ControlRow,{elementId:b.id,children:(0,t.Y)(l.Form.PasswordInput,{...b.props,minLength:6,isRequired:!0,autoFocus:!a.passwordEnabled,isDisabled:f})}),(0,t.Y)(l.Form.ControlRow,{elementId:S.id,children:(0,t.Y)(l.Form.PasswordInput,{...S.props,onChange:e=>(e.target.value&&z(e.target.value),S.props.onChange(e)),isRequired:!0,isDisabled:f})}),(0,t.Y)(l.Form.ControlRow,{elementId:C.id,children:(0,t.Y)(l.Form.Checkbox,{...C.props,description:(0,s.localizationKeys)("userProfile.passwordPage.checkboxInfoText__signOutOfOtherSessions"),isDisabled:f})}),f?(0,t.Y)(l.FormButtonContainer,{children:(0,t.Y)(l.Form.ResetButton,{localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),block:!1,onClick:r})}):(0,t.Y)(l.FormButtons,{isDisabled:!D,onReset:r})]})]})})),io=()=>{const{close:e}=(0,P.D5)();return(0,t.Y)(to,{onSuccess:e,onReset:e})},no=()=>{const{user:e}=(0,h.Jd)();if(!e)return null;const{passwordEnabled:o}=e;return(0,t.Y)(l.ProfileSection.Root,{centered:!1,title:(0,s.localizationKeys)("userProfile.start.passwordSection.title"),id:"password",children:(0,t.FD)(v.r.Root,{children:[(0,t.Y)(v.r.Closed,{value:"edit",children:(0,t.FD)(l.ProfileSection.Item,{id:"password",sx:e=>({paddingLeft:o?void 0:"0",paddingTop:e.space.$0x25,paddingBottom:e.space.$0x25}),children:[o&&(0,t.Y)(s.Text,{variant:"h2",children:"••••••••••"}),(0,t.Y)(v.r.Trigger,{value:"edit",children:(0,t.Y)(l.ProfileSection.Button,{id:"password",localizationKey:o?(0,s.localizationKeys)("userProfile.start.passwordSection.primaryButton__updatePassword"):(0,s.localizationKeys)("userProfile.start.passwordSection.primaryButton__setPassword")})})]})}),(0,t.Y)(v.r.Open,{value:"edit",children:(0,t.Y)(v.r.Card,{children:(0,t.Y)(io,{})})})]})})},so=(0,l.withCardStateProvider)((()=>{const{attributes:e,instanceIsPasswordBased:o}=(0,n.useEnvironment)().userSettings,r=(0,l.useCardState)(),{user:i}=(0,h.Jd)(),a=o,c=e.passkey.enabled,d=I(e).length>0,u=null==i?void 0:i.deleteSelfEnabled;return(0,t.Y)(s.Col,{elementDescriptor:s.descriptors.page,sx:e=>({gap:e.space.$8}),children:(0,t.FD)(s.Col,{elementDescriptor:s.descriptors.profilePage,elementId:s.descriptors.profilePage.setId("security"),children:[(0,t.Y)(l.Header.Root,{children:(0,t.Y)(l.Header.Title,{localizationKey:(0,s.localizationKeys)("userProfile.start.headerTitle__security"),sx:e=>({marginBottom:e.space.$4}),textVariant:"h2"})}),(0,t.Y)(l.Card.Alert,{children:r.error}),a&&(0,t.Y)(no,{}),c&&(0,t.Y)(Qe,{}),d&&(0,t.Y)(Je,{}),(0,t.Y)(ve,{}),u&&(0,t.Y)(Ce,{})]})})})),lo=()=>{var e;const{pages:o}=(0,n.useUserProfileContext)(),r=o.routes[0].id===m.j2.ACCOUNT,i=o.routes[0].id===m.j2.SECURITY,s=null===(e=o.contents)||void 0===e?void 0:e.map(((e,o)=>{const n=!r&&!i&&0===o;return(0,t.Y)(a.Route,{index:n,path:n?void 0:e.url,children:(0,t.Y)(u.H,{mount:e.mount,unmount:e.unmount})},`custom-page-${e.url}`)}));return(0,t.FD)(a.Switch,{children:[s,(0,t.FD)(a.Route,{children:[(0,t.Y)(a.Route,{path:r?void 0:"account",children:(0,t.Y)(a.Switch,{children:(0,t.Y)(a.Route,{index:!0,children:(0,t.Y)(fe,{})})})}),(0,t.Y)(a.Route,{path:i?void 0:"security",children:(0,t.Y)(a.Switch,{children:(0,t.Y)(a.Route,{index:!0,children:(0,t.Y)(so,{})})})})]})]})},ao=(0,n.withCoreUserGuard)((()=>{const e=i.useRef(null);return(0,t.Y)(l.ProfileCard.Root,{children:(0,t.FD)(d,{contentRef:e,children:[(0,t.Y)(l.NavbarMenuButtonRow,{navbarTitleLocalizationKey:(0,s.localizationKeys)("userProfile.navbar.title")}),(0,t.Y)(l.ProfileCard.Content,{contentRef:e,children:(0,t.Y)(lo,{})})]})})})),co=(0,l.withCardStateProvider)((e=>(0,t.Y)(s.Flow.Root,{flow:"userProfile",children:(0,t.Y)(s.Flow.Part,{children:(0,t.FD)(a.Switch,{children:[(0,t.Y)(a.Route,{path:"verify",children:(0,t.Y)(O,{})}),(0,t.Y)(a.Route,{children:(0,t.Y)(ao,{})})]})})}))),uo=e=>{const o={...e,routing:"virtual",componentName:"UserProfile",mode:"modal"};return(0,t.Y)(a.Route,{path:"user",children:(0,t.Y)(n.ComponentContext.Provider,{value:o,children:(0,t.Y)("div",{children:(0,t.Y)(co,{...o})})})})}}}]);